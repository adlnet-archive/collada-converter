var COLLADA;(function(e){var t=function(){function e(){}return e.prototype.isInstanceOf=function(e,t){return e._className.indexOf("|"+t+"|")>-1},e}();e.Context=t})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(){}return e.forEachChild=function(e,t){var n=e.childNodes,r=n.length;for(var i=0;i<r;i++){var s=n[i]||n.item(i);if(s.nodeType!==1)continue;t(s)}},e}();e.Utils=t})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},COLLADA;(function(e){var t;(function(e){var t=function(){function e(){this.target=null}return e.prototype.getUrl=function(){throw new Error("not implemented")},e.prototype.resolve=function(e){throw new Error("not implemented")},e}();e.Link=t;var n=function(e){function t(t){e.call(this),this.url=t.trim().replace(/^#/,"")}return __extends(t,e),t.prototype.getUrl=function(){return this.url},t.prototype.resolve=function(e){var t=e.ids[this.url];t!=null?this.target=t:e.log.write("Could not find URL target with URL "+this.url,4)},t}(t);e.UrlLink=n;var r=function(e){function t(t,n){e.call(this),this.url=t,this.scope=n}return __extends(t,e),t.prototype.getUrl=function(){return this.url},t.prototype.resolve=function(e){var t=this.scope,n=null;while(n==null&&t!=null)n=t.fxChildren[this.url],t=t.fxParent;n!=null?this.target=n:e.log.write("Could not find FX target with URL "+this.url,4)},t}(t);e.FxLink=r;var i=function(e){function t(t,n){e.call(this),this._parseUrl=function(){var e=this.url.split("/");this.id=e.shift(),this.id==="."&&(this.id=this.parentId);while(e.length>1)this.sids.push(e.shift());if(e.length>0){var t=e[0],n=t.indexOf(".")>=0,r=t.indexOf("(")>=0;if(n)e=t.split("."),this.sids.push(e.shift()),this.member=e.shift(),this.dotSyntax=!0;else if(r){var i=t.split("(");this.sids.push(i.shift()),this.indices=[];var s;for(var o=0,u=i.length;o<u;o++)s=i[o],this.indices.push(parseInt(s.replace(/\)/,""),10));this.arrSyntax=!0}else this.sids.push(t)}},this.url=t,this.id=null,this.parentId=n,this.sids=[],this.member=null,this.indices=[],this.dotSyntax=!1,this.arrSyntax=!1,this._parseUrl()}return __extends(t,e),t.prototype.getUrl=function(){return this.url},t.findSidTarget=function(e,t,n,r){var i={result:null,warning:null};if(t==null)return i.result=null,i.warning="Could not resolve SID target "+n.join("/")+", missing root element",i;var s=t,o=null;for(var u=0,a=n.length;u<a;u++){var f=n[u],l=[s];while(l.length!==0){var c=l.shift();if(c.sid===f){o=c;break}var h=c.sidChildren;if(h!=null)for(var p=0,d=h.length;p<d;p++){var v=h[p];l.push(v)}}if(o==null)return i.result=null,i.warning="Could not resolve SID target "+n.join("/")+", missing SID part "+f,i;s=o}return i.result=o,i.warning=null,i},t.prototype.resolve=function(e){var n=null;if(this.id==null){e.log.write("Could not resolve SID #"+this.url+", link has no root ID",4);return}n=e.ids[this.id];if(n==null){e.log.write("Could not resolve SID #"+this.url+", could not find root element "+this.id,4);return}var r=t.findSidTarget(this.url,n,this.sids,e);r.warning&&e.log.write(r.warning,4),this.target=r.result},t}(t);e.SidLink=i})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(){this.name=null,this.id=null,this.sid=null,this.fxParent=null,this.fxChildren={},this.sidChildren=[],this._className="|Element|"}return t.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Element",n)},t._fromLink=function(e,t,n){return e===null?null:e.target===null?null:n.isInstanceOf(e.target,t)?e.target:(n.log.write("Link with url "+e.url+" does not point to a "+t+", link target ignored",5),null)},t}();t.Element=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(e){function n(){e.call(this),this.log=null,this.ids={},this.links=[],this.totalBytes=null,this.loadedBytes=null}return __extends(n,e),n.prototype.getTextContent=function(e){return e.textContent||e.firstChild.getNodeValue()+""},n.prototype.getFloatsContent=function(e){return this.strToFloats(this.getTextContent(e))},n.prototype.getFloatContent=function(e){return parseFloat(this.getTextContent(e))},n.prototype.getIntsContent=function(e){return this.strToInts(this.getTextContent(e))},n.prototype.getIntContent=function(e){return parseInt(this.getTextContent(e),10)},n.prototype.getBoolsContent=function(e){return this.strToBools(this.getTextContent(e))},n.prototype.getStringsContent=function(e){return this.strToStrings(this.getTextContent(e))},n.prototype.getAttributeAsFloat=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?parseFloat(i.value):r?(this.log.write("Element "+e.nodeName+" is missing required float attribute "+t+". Using default value "+n+".",5),n):n},n.prototype.getAttributeAsInt=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?parseInt(i.value,10):r?(this.log.write("Element "+e.nodeName+" is missing required integer attribute "+t+". Using default value "+n+".",5),n):n},n.prototype.getAttributeAsString=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?i.value+"":r?(this.log.write("Element "+e.nodeName+" is missing required string attribute "+t+". Using default value "+n+".",5),n):n},n.prototype.createUrlLink=function(e){var n=new t.UrlLink(e);return this.links.push(n),n},n.prototype.createSidLink=function(e,n){var r=new t.SidLink(e,n);return this.links.push(r),r},n.prototype.createFxLink=function(e,n){var r=new t.FxLink(e,n);return this.links.push(r),r},n.prototype.getAttributeAsUrlLink=function(e,t,n){var r=e.attributes.getNamedItem(t);return r!=null?this.createUrlLink(r.value):n?(this.log.write("Element "+e.nodeName+" is missing required URL link attribute "+t+".",5),null):null},n.prototype.getAttributeAsSidLink=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?this.createSidLink(i.value,n):r?(this.log.write("Element "+e.nodeName+" is missing required SID link attribute "+t+".",5),null):null},n.prototype.getAttributeAsFxLink=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?this.createFxLink(i.value,n):r?(this.log.write("Element "+e.nodeName+" is missing required FX link attribute "+t+".",5),null):null},n.prototype.strToStrings=function(e){return e.length>0?e.trim().split(/\s+/):[]},n.prototype.strToFloats=function(e){var t=this.strToStrings(e),n=new Float32Array(t.length),r=t.length;for(var i=0;i<r;++i)n[i]=parseFloat(t[i]);return n},n.prototype.strToInts=function(e){var t=this.strToStrings(e),n=new Int32Array(t.length),r=t.length;for(var i=0;i<r;++i)n[i]=parseInt(t[i],10);return n},n.prototype.strToUints=function(e){var t=this.strToStrings(e),n=new Uint32Array(t.length),r=t.length;for(var i=0;i<r;++i)n[i]=parseInt(t[i],10);return n},n.prototype.strToBools=function(e){var t=this.strToStrings(e),n=new Uint8Array(t.length),r=t.length;for(var i=0;i<r;++i)n[i]=t[i]==="true"||t[i]==="1"?1:0;return n},n.prototype.strToColor=function(e){var t=this.strToFloats(e);return t.length===4?t:(this.log.write("Skipped color element because it does not contain 4 numbers",5),null)},n.prototype.registerUrlTarget=function(e,t){var n=e.id;if(n==null){t&&this.log.write("Object has no ID, object was not registered as a URL target.",5);return}if(this.ids[n]!=null){this.log.write("There is already an object with ID "+n+". IDs must be globally unique.",5);return}this.ids[n]=e},n.prototype.registerFxTarget=function(e,t){var n=e.sid;if(n==null){this.log.write("Cannot add a FX target: object has no SID.",5);return}if(t.fxChildren[n]!=null){this.log.write("There is already an FX target with SID "+n+".",5);return}e.fxParent=t,t.fxChildren[n]=e},n.prototype.registerSidTarget=function(e,t){t.sidChildren.push(e)},n.prototype.getNodePath=function(e){var t="<"+e.nodeName+">",n=1,r=10;while(e.parentNode!=null){e=e.parentNode;if(e.nodeName.toUpperCase()==="COLLADA")break;if(n>=r){t=".../"+t;break}t="<"+e.nodeName+">/"+t,n+=1}return t},n.prototype.reportUnexpectedChild=function(e){this.log.write("Skipped unexpected element "+this.getNodePath(e)+".",4)},n.prototype.reportUnhandledChild=function(e){this.log.write("Element "+this.getNodePath(e)+" is legal, but not handled by this loader.",2)},n.prototype.resolveAllLinks=function(){var e=this.links.length;for(var t=0;t<e;++t){var n=this.links[t];n.resolve(this)}},n}(e.Context);t.Context=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){this.children=[]}return n.parse=function(n,r,i,s){var o=new e.Loader.Library;return t.Utils.forEachChild(n,function(e){switch(e.nodeName){case i:o.children.push(r(e,s));break;case"extra":s.reportUnhandledChild(e);break;default:s.reportUnexpectedChild(e)}}),o},n}();t.Library=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Asset|",this.unit=null,this.upAxis=null}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.Asset;return t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"unit":i.unit=r.getAttributeAsFloat(e,"meter",1,!1);break;case"up_axis":i.upAxis=r.getTextContent(e).toUpperCase().charAt(0);break;case"contributor":case"created":case"modified":case"revision":case"title":case"subject":case"keywords":r.reportUnhandledChild(e);break;default:r.reportUnexpectedChild(e)}}),i},r}(e.Loader.Element);t.Asset=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Scene|",this.instance=null}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.Scene;return t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"instance_visual_scene":i.instance=r.getAttributeAsUrlLink(e,"url",!0);break;default:r.reportUnexpectedChild(e)}}),i},r}(e.Loader.Element);t.Scene=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="EffectSurface|",this.type=null,this.initFrom=null,this.format=null,this.size=null,this.viewportRatio=null,this.mipLevels=null,this.mipmapGenerate=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"EffectSurface",n)},r.parse=function(n,r,i){var s=new e.Loader.EffectSurface;return s.type=i.getAttributeAsString(n,"type",null,!0),t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"init_from":s.initFrom=i.createUrlLink(i.getTextContent(e));break;case"format":s.format=i.getTextContent(e);break;case"size":s.size=i.getFloatsContent(e);break;case"viewport_ratio":s.viewportRatio=i.getFloatsContent(e);break;case"mip_levels":s.mipLevels=i.getIntContent(e);break;case"mipmap_generate":s.mipmapGenerate=i.getTextContent(e).toLowerCase()==="true";break;default:i.reportUnexpectedChild(e)}}),s},r}(e.Loader.Element);t.EffectSurface=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="EffectSampler|",this.surface=null,this.image=null,this.wrapS=null,this.wrapT=null,this.minFilter=null,this.magFilter=null,this.borderColor=null,this.mipmapMaxLevel=null,this.mipmapBias=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"EffectSampler",n)},r.parse=function(n,r,i){var s=new e.Loader.EffectSampler;return t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"source":s.surface=i.createFxLink(i.getTextContent(e),r);break;case"instance_image":s.image=i.getAttributeAsUrlLink(e,"url",!0);break;case"wrap_s":s.wrapS=i.getTextContent(e);break;case"wrap_t":s.wrapT=i.getTextContent(e);break;case"minfilter":s.minFilter=i.getTextContent(e);break;case"magfilter":s.magFilter=i.getTextContent(e);break;case"border_color":s.borderColor=i.getFloatsContent(e);break;case"mipmap_maxlevel":s.mipmapMaxLevel=i.getIntContent(e);break;case"mipmap_bias":s.mipmapBias=i.getFloatContent(e);break;default:i.reportUnexpectedChild(e)}}),s},r}(e.Loader.Element);t.EffectSampler=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="EffectParam|",this.semantic=null,this.surface=null,this.sampler=null,this.floats=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"EffectParam",n)},r.parse=function(n,r,i){var s=new e.Loader.EffectParam;return s.sid=i.getAttributeAsString(n,"sid",null,!1),i.registerFxTarget(s,r),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"semantic":s.semantic=i.getTextContent(t);break;case"float":s.floats=i.getFloatsContent(t);break;case"float2":s.floats=i.getFloatsContent(t);break;case"float3":s.floats=i.getFloatsContent(t);break;case"float4":s.floats=i.getFloatsContent(t);break;case"surface":s.surface=e.Loader.EffectSurface.parse(t,s,i);break;case"sampler2D":s.sampler=e.Loader.EffectSampler.parse(t,s,i);break;default:i.reportUnexpectedChild(t)}}),s},r}(e.Loader.Element);t.EffectParam=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="ColorOrTexture|",this.color=null,this.textureSampler=null,this.texcoord=null,this.opaque=null,this.bumptype=null}return __extends(r,n),r.parse=function(n,r,i){var s=new e.Loader.ColorOrTexture;return s.opaque=i.getAttributeAsString(n,"opaque",null,!1),s.bumptype=i.getAttributeAsString(n,"bumptype",null,!1),t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"color":s.color=i.strToColor(i.getTextContent(e));break;case"texture":s.textureSampler=i.getAttributeAsFxLink(e,"texture",r,!0),s.texcoord=i.getAttributeAsString(e,"texcoord",null,!0);break;default:i.reportUnexpectedChild(e)}}),s},r}(e.Loader.Element);t.ColorOrTexture=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="EffectTechnique|",this.params=[],this.shading=null,this.emission=null,this.ambient=null,this.diffuse=null,this.specular=null,this.reflective=null,this.transparent=null,this.bump=null,this.shininess=null,this.transparency=null,this.reflectivity=null,this.index_of_refraction=null,this.double_sided=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"EffectTechnique",n)},r.parse=function(n,r,i){var s=new e.Loader.EffectTechnique;return s.sid=i.getAttributeAsString(n,"sid",null,!1),i.registerFxTarget(s,r),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"blinn":case"phong":case"lambert":case"constant":s.shading=t.nodeName,e.Loader.EffectTechnique.parseParam(t,s,"COMMON",i);break;case"extra":e.Loader.EffectTechnique.parseExtra(t,s,i);break;default:i.reportUnexpectedChild(t)}}),s},r.parseParam=function(n,r,i,s){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"newparam":r.params.push(e.Loader.EffectParam.parse(t,r,s));break;case"emission":r.emission=e.Loader.ColorOrTexture.parse(t,r,s);break;case"ambient":r.ambient=e.Loader.ColorOrTexture.parse(t,r,s);break;case"diffuse":r.diffuse=e.Loader.ColorOrTexture.parse(t,r,s);break;case"specular":r.specular=e.Loader.ColorOrTexture.parse(t,r,s);break;case"reflective":r.reflective=e.Loader.ColorOrTexture.parse(t,r,s);break;case"transparent":r.transparent=e.Loader.ColorOrTexture.parse(t,r,s);break;case"bump":r.bump=e.Loader.ColorOrTexture.parse(t,r,s);break;case"shininess":r.shininess=s.getFloatContent(t.childNodes[1]||t.childNodes.item(0));break;case"reflectivity":r.reflectivity=s.getFloatContent(t.childNodes[1]||t.childNodes.item(0));break;case"transparency":r.transparency=s.getFloatContent(t.childNodes[1]||t.childNodes.item(0));break;case"index_of_refraction":r.index_of_refraction=s.getFloatContent(t.childNodes[1]||t.childNodes.item(0));break;case"double_sided":r.double_sided=s.getFloatContent(t)>0;break;default:i==="COMMON"&&s.reportUnexpectedChild(t)}})},r.parseExtra=function(n,r,i){if(r==null){i.log.write("Ignored element <extra>, because there is no <technique>.",4);return}t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"technique":var n=i.getAttributeAsString(t,"profile",null,!0);e.Loader.EffectTechnique.parseParam(t,r,n,i);break;default:i.reportUnexpectedChild(t)}})},r}(e.Loader.Element);t.EffectTechnique=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Effect|",this.params=[],this.technique=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Effect",n)},r.parse=function(n,r){var i=new e.Loader.Effect;return i.id=r.getAttributeAsString(n,"id",null,!0),r.registerUrlTarget(i,!0),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"profile_COMMON":e.Loader.Effect.parseProfileCommon(t,i,r);break;case"profile":r.log.write("Skipped non-common effect profile for effect "+i.id+".",4);break;case"extra":e.Loader.EffectTechnique.parseExtra(t,i.technique,r);break;default:r.reportUnexpectedChild(t)}}),i},r.parseProfileCommon=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"newparam":r.params.push(e.Loader.EffectParam.parse(t,r,i));break;case"technique":r.technique=e.Loader.EffectTechnique.parse(t,r,i);break;case"extra":e.Loader.EffectTechnique.parseExtra(t,r.technique,i);break;default:i.reportUnexpectedChild(t)}})},r}(e.Loader.Element);t.Effect=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Material|",this.effect=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Material",n)},r.parse=function(n,r){var i=new e.Loader.Material;return i.id=r.getAttributeAsString(n,"id",null,!0),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!0),t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"instance_effect":i.effect=r.getAttributeAsUrlLink(e,"url",!0);break;default:r.reportUnexpectedChild(e)}}),i},r}(e.Loader.Element);t.Material=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Source|",this.sourceId=null,this.count=null,this.stride=null,this.offset=null,this.data=null,this.params={}}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Source",n)},r.parse=function(n,r){var i=new e.Loader.Source;return i.id=r.getAttributeAsString(n,"id",null,!0),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!0),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"bool_array":i.sourceId=r.getAttributeAsString(t,"id",null,!1),i.data=r.getBoolsContent(t);break;case"float_array":i.sourceId=r.getAttributeAsString(t,"id",null,!1),i.data=r.getFloatsContent(t);break;case"int_array":i.sourceId=r.getAttributeAsString(t,"id",null,!1),i.data=r.getIntsContent(t);break;case"IDREF_array":case"Name_array":i.sourceId=r.getAttributeAsString(t,"id",null,!1),i.data=r.getStringsContent(t);break;case"technique_common":e.Loader.Source.parseSourceTechniqueCommon(t,i,r);break;case"technique":r.reportUnhandledChild(t);break;default:r.reportUnexpectedChild(t)}}),i},r.parseSourceTechniqueCommon=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"accessor":e.Loader.Source.parseAccessor(t,r,i);break;default:i.reportUnexpectedChild(t)}})},r.parseAccessor=function(n,r,i){var s=i.getAttributeAsString(n,"source",null,!0);r.count=i.getAttributeAsInt(n,"count",0,!0),r.stride=i.getAttributeAsInt(n,"stride",1,!1),r.offset=i.getAttributeAsInt(n,"offset",0,!1),s!=="#"+r.sourceId&&i.log.write("Source "+r.id+" uses a non-local data source, this is not supported",5),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"param":e.Loader.Source.parseAccessorParam(t,r,i);break;default:i.reportUnexpectedChild(t)}})},r.parseAccessorParam=function(e,t,n){var r=n.getAttributeAsString(e,"name",null,!1),i=n.getAttributeAsString(e,"semantic",null,!1),s=n.getAttributeAsString(e,"type",null,!0),o=n.getAttributeAsString(e,"sid",null,!1);r!=null&&s!=null?t.params[r]=s:i!=null&&s!=null?t.params[i]=s:s!=null?t.params["unnamed param #"+Object.keys(t.params).length]=s:n.log.write("Accessor param for source "+t.id+" ignored due to missing type",4)},r}(e.Loader.Element);t.Source=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(t){function n(){t.call(this),this._className+="Input|",this.semantic=null,this.source=null,this.offset=null,this.set=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.Input;return i.semantic=r.getAttributeAsString(t,"semantic",null,!0),i.source=r.getAttributeAsUrlLink(t,"source",!0),n&&(i.offset=r.getAttributeAsInt(t,"offset",0,!0),i.set=r.getAttributeAsInt(t,"set",null,!1)),i},n}(e.Loader.Element);t.Input=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Triangles|",this.type=null,this.count=null,this.material=null,this.inputs=[],this.indices=null,this.vcount=null}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.Triangles;return i.name=r.getAttributeAsString(n,"name",null,!1),i.material=r.getAttributeAsString(n,"material",null,!1),i.count=r.getAttributeAsInt(n,"count",0,!0),i.type=n.nodeName,t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"input":i.inputs.push(e.Loader.Input.parse(t,!0,r));break;case"vcount":i.vcount=r.getIntsContent(t);break;case"p":i.indices=r.getIntsContent(t);break;default:r.reportUnexpectedChild(t)}}),i},r}(e.Loader.Element);t.Triangles=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Vertices|",this.inputs=[]}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Vertices",n)},r.parse=function(n,r){var i=new e.Loader.Vertices;return i.id=r.getAttributeAsString(n,"id",null,!0),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!0),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"input":i.inputs.push(e.Loader.Input.parse(t,!1,r));break;default:r.reportUnexpectedChild(t)}}),i},r}(e.Loader.Element);t.Vertices=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Geometry|",this.sources=[],this.vertices=[],this.triangles=[]}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Geometry",n)},r.parse=function(n,r){var i=new e.Loader.Geometry;return i.id=r.getAttributeAsString(n,"id",null,!0),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!0),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"mesh":e.Loader.Geometry.parseMesh(t,i,r);break;case"convex_mesh":case"spline":r.log.write("Geometry type "+t.nodeName+" not supported.",5);break;case"extra":e.Loader.Geometry.parseGeometryExtra(t,i,r);break;default:r.reportUnexpectedChild(t)}}),i},r.parseMesh=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"source":r.sources.push(e.Loader.Source.parse(t,i));break;case"vertices":r.vertices.push(e.Loader.Vertices.parse(t,i));break;case"triangles":case"polylist":case"polygons":r.triangles.push(e.Loader.Triangles.parse(t,i));break;case"lines":case"linestrips":case"trifans":case"tristrips":i.log.write("Geometry primitive type "+t.nodeName+" not supported.",5);break;default:i.reportUnexpectedChild(t)}})},r.parseGeometryExtra=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"technique":var n=i.getAttributeAsString(t,"profile",null,!0);e.Loader.Geometry.parseGeometryExtraTechnique(t,r,n,i);break;default:i.reportUnexpectedChild(t)}})},r.parseGeometryExtraTechnique=function(e,n,r,i){t.Utils.forEachChild(e,function(e){switch(e.nodeName){default:i.reportUnhandledChild(e)}})},r}(e.Loader.Element);t.Geometry=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Joints|",this.joints=null,this.invBindMatrices=null}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.Joints,s=[];return t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"input":var n=e.Loader.Input.parse(t,!1,r);e.Loader.Joints.addInput(i,n,r),s.push();break;default:r.reportUnexpectedChild(t)}}),i},r.addInput=function(e,t,n){switch(t.semantic){case"JOINT":e.joints=t;break;case"INV_BIND_MATRIX":e.invBindMatrices=t;break;default:n.log.write("Unknown joints input semantic "+t.semantic,5)}},r}(e.Loader.Element);t.Joints=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="VertexWeights|",this.inputs=[],this.vcount=null,this.v=null,this.joints=null,this.weights=null,this.count=null}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.VertexWeights;return i.count=r.getAttributeAsInt(n,"count",0,!0),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"input":var n=e.Loader.Input.parse(t,!0,r);e.Loader.VertexWeights.addInput(i,n,r);break;case"vcount":i.vcount=r.getIntsContent(t);break;case"v":i.v=r.getIntsContent(t);break;default:r.reportUnexpectedChild(t)}}),i},r.addInput=function(e,t,n){switch(t.semantic){case"JOINT":e.joints=t;break;case"WEIGHT":e.weights=t;break;default:n.log.write("Unknown vertex weights input semantic "+t.semantic,5)}},r}(e.Loader.Element);t.VertexWeights=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Skin|",this.source=null,this.bindShapeMatrix=null,this.sources=[],this.joints=null,this.vertexWeights=null}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.Skin;return i.source=r.getAttributeAsUrlLink(n,"source",!0),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"bind_shape_matrix":i.bindShapeMatrix=r.getFloatsContent(t);break;case"source":i.sources.push(e.Loader.Source.parse(t,r));break;case"joints":i.joints=e.Loader.Joints.parse(t,r);break;case"vertex_weights":i.vertexWeights=e.Loader.VertexWeights.parse(t,r);break;default:r.reportUnexpectedChild(t)}}),i},r}(e.Loader.Element);t.Skin=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(t){function n(){t.call(this),this._className+="Morph|"}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Morph;return n.log.write("Morph controllers not implemented",5),r},n}(e.Loader.Element);t.Morph=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Controller|",this.skin=null,this.morph=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Controller",n)},r.parse=function(n,r){var i=new e.Loader.Controller;return i.id=r.getAttributeAsString(n,"id",null,!0),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!0),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"skin":i.skin!=null&&r.log.write("Controller "+i.id+" has multiple skins",5),i.skin=e.Loader.Skin.parse(t,r);break;case"morph":i.morph!=null&&r.log.write("Controller "+i.id+" has multiple morphs",5),i.morph=e.Loader.Morph.parse(t,r);break;default:r.reportUnexpectedChild(t)}}),i},r}(e.Loader.Element);t.Controller=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(t){function n(){t.call(this),this._className+="LightParam|",this.value=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.LightParam;return r.sid=n.getAttributeAsString(t,"sid",null,!1),r.name=t.nodeName,r.value=n.getFloatContent(t),r},n}(e.Loader.Element);t.LightParam=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Light|",this.type=null,this.color=null,this.params={}}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.Light;return i.id=r.getAttributeAsString(n,"id",null,!0),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!1),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"technique_common":e.Loader.Light.parseTechniqueCommon(t,i,r);break;case"extra":r.reportUnhandledChild(t);break;default:r.reportUnexpectedChild(t)}}),i},r.parseTechniqueCommon=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"ambient":case"directional":case"point":case"spot":e.Loader.Light.parseParams(t,r,"COMMON",i);break;default:i.reportUnexpectedChild(t)}})},r.parseParams=function(n,r,i,s){r.type=n.nodeName,t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"color":r.color=s.getFloatsContent(t);break;case"constant_attenuation":case"linear_attenuation":case"quadratic_attenuation":case"falloff_angle":case"falloff_exponent":var n=e.Loader.LightParam.parse(t,s);s.registerSidTarget(n,r),r.params[n.name]=n;break;default:s.reportUnexpectedChild(t)}})},r}(e.Loader.Element);t.Light=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(t){function n(){t.call(this),this._className+="CameraParam|",this.value=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.CameraParam;return r.sid=n.getAttributeAsString(t,"sid",null,!1),r.name=t.nodeName,r.value=parseFloat(n.getTextContent(t)),r},n}(e.Loader.Element);t.CameraParam=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Camera|",this.type=null,this.params={}}return __extends(r,n),r.parse=function(n,r){var i=new e.Loader.Camera;return i.id=r.getAttributeAsString(n,"id",null,!0),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!1),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"asset":r.reportUnhandledChild(t);break;case"optics":e.Loader.Camera.parseOptics(t,i,r);break;case"imager":r.reportUnhandledChild(t);break;case"extra":r.reportUnhandledChild(t);break;default:r.reportUnexpectedChild(t)}}),i},r.parseOptics=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"technique_common":e.Loader.Camera.parseTechniqueCommon(t,r,i);break;case"technique":i.reportUnhandledChild(t);break;case"extra":i.reportUnhandledChild(t);break;default:i.reportUnexpectedChild(t)}})},r.parseTechniqueCommon=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"orthographic":e.Loader.Camera.parseParams(t,r,i);break;case"perspective":e.Loader.Camera.parseParams(t,r,i);break;default:i.reportUnexpectedChild(t)}})},r.parseParams=function(n,r,i){r.type=n.nodeName,t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"xmag":case"ymag":case"xfov":case"yfov":case"aspect_ratio":case"znear":case"zfar":var n=e.Loader.CameraParam.parse(t,i);i.registerSidTarget(n,r),r.params[n.name]=n;break;case"extra":i.reportUnhandledChild(t);break;default:i.reportUnexpectedChild(t)}})},r}(e.Loader.Element);t.Camera=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Image|",this.initFrom=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Image",n)},r.parse=function(n,r){var i=new e.Loader.Image;return i.id=r.getAttributeAsString(n,"id",null,!0),r.registerUrlTarget(i,!0),t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"init_from":i.initFrom=r.getTextContent(e);break;default:r.reportUnexpectedChild(e)}}),i},r}(e.Loader.Element);t.Image=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="InstanceCamera|",this.camera=null}return __extends(r,n),r.parse=function(n,r,i){var s=new e.Loader.InstanceCamera;return s.camera=i.getAttributeAsUrlLink(n,"url",!0),s.sid=i.getAttributeAsString(n,"sid",null,!1),s.name=i.getAttributeAsString(n,"name",null,!1),i.registerSidTarget(s,r),t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"extra":i.reportUnhandledChild(e
);break;default:i.reportUnexpectedChild(e)}}),s},r}(e.Loader.Element);t.InstanceCamera=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){}return n.parse=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"technique_common":e.Loader.BindMaterial.parseTechniqueCommon(t,r,i);break;default:i.reportUnexpectedChild(t)}})},n.parseTechniqueCommon=function(n,r,i){t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"instance_material":r.materials.push(e.Loader.InstanceMaterial.parse(t,r,i));break;default:i.reportUnexpectedChild(t)}})},n}();t.BindMaterial=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="InstanceMaterial|",this.material=null,this.symbol=null,this.params={},this.vertexInputs={}}return __extends(r,n),r.parse=function(n,r,i){var s=new e.Loader.InstanceMaterial;return s.symbol=i.getAttributeAsString(n,"symbol",null,!1),s.material=i.getAttributeAsUrlLink(n,"target",!0),i.registerSidTarget(s,r),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"bind_vertex_input":e.Loader.InstanceMaterial.parseBindVertexInput(t,s,i);break;case"bind":e.Loader.InstanceMaterial.parseBind(t,s,i);break;default:i.reportUnexpectedChild(t)}}),s},r.parseBindVertexInput=function(e,t,n){var r=n.getAttributeAsString(e,"semantic",null,!0),i=n.getAttributeAsString(e,"input_semantic",null,!0),s=n.getAttributeAsInt(e,"input_set",null,!1);r!=null&&i!=null?t.vertexInputs[r]={inputSemantic:i,inputSet:s}:n.log.write("Skipped a material vertex binding because of missing semantics.",4)},r.parseBind=function(e,t,n){var r=n.getAttributeAsString(e,"semantic",null,!1),i=n.getAttributeAsSidLink(e,"target",null,!0);r!=null?t.params[r]={target:i}:n.log.write("Skipped a material uniform binding because of missing semantics.",4)},r}(e.Loader.Element);t.InstanceMaterial=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="InstanceController|",this.controller=null,this.skeletons=[],this.materials=[]}return __extends(r,n),r.parse=function(n,r,i){var s=new e.Loader.InstanceController;return s.controller=i.getAttributeAsUrlLink(n,"url",!0),s.sid=i.getAttributeAsString(n,"sid",null,!1),s.name=i.getAttributeAsString(n,"name",null,!1),i.registerSidTarget(s,r),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"skeleton":s.skeletons.push(i.createUrlLink(i.getTextContent(t)));break;case"bind_material":e.Loader.BindMaterial.parse(t,s,i);break;default:i.reportUnexpectedChild(t)}}),s},r}(e.Loader.Element);t.InstanceController=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="InstanceGeometry|",this.geometry=null,this.materials=[]}return __extends(r,n),r.parse=function(n,r,i){var s=new e.Loader.InstanceGeometry;return s.geometry=i.getAttributeAsUrlLink(n,"url",!0),s.sid=i.getAttributeAsString(n,"sid",null,!1),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"bind_material":e.Loader.BindMaterial.parse(t,s,i);break;default:i.reportUnexpectedChild(t)}}),s},r}(e.Loader.Element);t.InstanceGeometry=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="InstanceLight|",this.light=null}return __extends(r,n),r.parse=function(n,r,i){var s=new e.Loader.InstanceLight;return s.light=i.getAttributeAsUrlLink(n,"url",!0),s.sid=i.getAttributeAsString(n,"sid",null,!1),s.name=i.getAttributeAsString(n,"name",null,!1),i.registerSidTarget(s,r),t.Utils.forEachChild(n,function(e){switch(e.nodeName){case"extra":i.reportUnhandledChild(e);break;default:i.reportUnexpectedChild(e)}}),s},r}(e.Loader.Element);t.InstanceLight=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(t){function n(){t.call(this),this._className+="NodeTransform|",this.type=null,this.data=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.NodeTransform;i.sid=r.getAttributeAsString(t,"sid",null,!1),i.type=t.nodeName,r.registerSidTarget(i,n),i.data=r.getFloatsContent(t);var s=0;switch(i.type){case"matrix":s=16;break;case"rotate":s=4;break;case"translate":s=3;break;case"scale":s=3;break;case"skew":s=7;break;case"lookat":s=9;break;default:r.log.write("Unknown transformation type "+i.type+".",5)}return i.data.length!==s&&r.log.write("Wrong number of elements for transformation type '"+i.type+"': expected "+s+", found "+i.data.length,5),i},n}(e.Loader.Element);t.NodeTransform=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="VisualSceneNode|",this.type=null,this.layer=null,this.children=[],this.parent=null,this.transformations=[],this.geometries=[],this.controllers=[],this.lights=[],this.cameras=[]}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"VisualSceneNode",n)},r.registerParent=function(e,t,n){e.parent=t,n.registerSidTarget(e,t)},r.parse=function(n,r){var i=new e.Loader.VisualSceneNode;return i.id=r.getAttributeAsString(n,"id",null,!1),i.sid=r.getAttributeAsString(n,"sid",null,!1),i.name=r.getAttributeAsString(n,"name",null,!1),i.type=r.getAttributeAsString(n,"type",null,!1),i.layer=r.getAttributeAsString(n,"layer",null,!1),r.registerUrlTarget(i,!1),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"instance_geometry":i.geometries.push(e.Loader.InstanceGeometry.parse(t,i,r));break;case"instance_controller":i.controllers.push(e.Loader.InstanceController.parse(t,i,r));break;case"instance_light":i.lights.push(e.Loader.InstanceLight.parse(t,i,r));break;case"instance_camera":i.cameras.push(e.Loader.InstanceCamera.parse(t,i,r));break;case"matrix":case"rotate":case"translate":case"scale":i.transformations.push(e.Loader.NodeTransform.parse(t,i,r));break;case"node":var n=e.Loader.VisualSceneNode.parse(t,r);e.Loader.VisualSceneNode.registerParent(n,i,r),i.children.push(n);break;case"extra":r.reportUnhandledChild(t);break;default:r.reportUnexpectedChild(t)}}),i},r}(e.Loader.Element);t.VisualSceneNode=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="VisualScene|",this.children=[]}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"VisualScene",n)},r.parse=function(n,r){var i=new e.Loader.VisualScene;return i.id=r.getAttributeAsString(n,"id",null,!1),r.registerUrlTarget(i,!1),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"node":var n=e.Loader.VisualSceneNode.parse(t,r);e.Loader.VisualSceneNode.registerParent(n,i,r),i.children.push(n);break;default:r.reportUnexpectedChild(t)}}),i},r}(e.Loader.Element);t.VisualScene=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Sampler|",this.input=null,this.outputs=[],this.inTangents=[],this.outTangents=[],this.interpolation=null}return __extends(r,n),r.fromLink=function(t,n){return e.Loader.Element._fromLink(t,"Sampler",n)},r.parse=function(n,r){var i=new e.Loader.Sampler;return i.id=r.getAttributeAsString(n,"id",null,!1),r.registerUrlTarget(i,!1),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"input":var n=e.Loader.Input.parse(t,!1,r);e.Loader.Sampler.addInput(i,n,r);break;default:r.reportUnexpectedChild(t)}}),i},r.addInput=function(e,t,n){switch(t.semantic){case"INPUT":e.input=t;break;case"OUTPUT":e.outputs.push(t);break;case"INTERPOLATION":e.interpolation=t;break;case"IN_TANGENT":e.inTangents.push(t);break;case"OUT_TANGENT":e.outTangents.push(t);break;default:n.log.write("Unknown sampler input semantic "+t.semantic,5)}},r}(e.Loader.Element);t.Sampler=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Channel|",this.source=null,this.target=null}return __extends(r,n),r.parse=function(n,r,i){var s=new e.Loader.Channel;return s.source=i.getAttributeAsUrlLink(n,"source",!0),s.target=i.getAttributeAsSidLink(n,"target",r.id,!0),t.Utils.forEachChild(n,function(e){switch(e.nodeName){default:i.reportUnexpectedChild(e)}}),s},r}(e.Loader.Element);t.Channel=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(n){function r(){n.call(this),this._className+="Animation|",this.parent=null,this.children=[],this.sources=[],this.samplers=[],this.channels=[]}return __extends(r,n),r.prototype.root=function(){return this.parent!=null?this.parent.root():this},r.parse=function(n,r){var i=new e.Loader.Animation;return i.id=r.getAttributeAsString(n,"id",null,!1),i.name=r.getAttributeAsString(n,"name",null,!1),r.registerUrlTarget(i,!1),t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"animation":var n=e.Loader.Animation.parse(t,r);n.parent=i,i.children.push(n);break;case"source":i.sources.push(e.Loader.Source.parse(t,r));break;case"sampler":i.samplers.push(e.Loader.Sampler.parse(t,r));break;case"channel":i.channels.push(e.Loader.Channel.parse(t,i,r));break;default:r.reportUnexpectedChild(t)}}),i},r}(e.Loader.Element);t.Animation=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){this.scene=null,this.asset=null,this.libEffects=new e.Loader.Library,this.libMaterials=new e.Loader.Library,this.libGeometries=new e.Loader.Library,this.libControllers=new e.Loader.Library,this.libLights=new e.Loader.Library,this.libCameras=new e.Loader.Library,this.libImages=new e.Loader.Library,this.libVisualScenes=new e.Loader.Library,this.libAnimations=new e.Loader.Library,this.libNodes=new e.Loader.Library}return n.parse=function(t,n){var r=t.getElementsByTagName("COLLADA");return r.length===0?(n.log.write("Cannot parse document, no top level COLLADA element.",5),new e.Loader.Document):r.length>1?(n.log.write("Cannot parse document, more than one top level COLLADA element.",5),new e.Loader.Document):e.Loader.Document.parseCOLLADA(r[0]||r.item(0),n)},n.parseCOLLADA=function(n,r){var i=new e.Loader.Document;return t.Utils.forEachChild(n,function(t){switch(t.nodeName){case"asset":i.asset=e.Loader.Asset.parse(t,r);break;case"scene":i.scene=e.Loader.Scene.parse(t,r);break;case"library_effects":i.libEffects=e.Loader.Library.parse(t,e.Loader.Effect.parse,"effect",r);break;case"library_materials":i.libMaterials=e.Loader.Library.parse(t,e.Loader.Material.parse,"material",r);break;case"library_geometries":i.libGeometries=e.Loader.Library.parse(t,e.Loader.Geometry.parse,"geometry",r);break;case"library_images":i.libImages=e.Loader.Library.parse(t,e.Loader.Image.parse,"image",r);break;case"library_visual_scenes":i.libVisualScenes=e.Loader.Library.parse(t,e.Loader.VisualScene.parse,"visual_scene",r);break;case"library_controllers":i.libControllers=e.Loader.Library.parse(t,e.Loader.Controller.parse,"controller",r);break;case"library_animations":i.libAnimations=e.Loader.Library.parse(t,e.Loader.Animation.parse,"animation",r);break;case"library_lights":i.libLights=e.Loader.Library.parse(t,e.Loader.Light.parse,"effect",r);break;case"library_cameras":i.libCameras=e.Loader.Library.parse(t,e.Loader.Camera.parse,"camera",r);break;case"library_nodes":i.libNodes=e.Loader.Library.parse(t,e.Loader.VisualSceneNode.parse,"node",r);break;default:this.reportUnexpectedChild(t)}}),i},n}();t.Document=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){function n(e){switch(e){case 1:return"DEBUG";case 2:return"TRACE";case 3:return"INFO";case 4:return"WARNING";case 5:return"ERROR";case 6:return"EXCEPTION";default:return"OTHER"}}(function(e){e[e.Debug=1]="Debug",e[e.Trace=2]="Trace",e[e.Info=3]="Info",e[e.Warning=4]="Warning",e[e.Error=5]="Error",e[e.Exception=6]="Exception"})(e.LogLevel||(e.LogLevel={}));var t=e.LogLevel;e.LogLevelToString=n;var r=function(){function e(){}return e.prototype.write=function(e,t){this.onmessage&&this.onmessage(e,t)},e}();e.LogCallback=r;var i=function(){function e(){this.messages=[]}return e.prototype.write=function(e,t){this.messages.push({message:e,level:t})},e}();e.LogArray=i;var s=function(){function e(){}return e.prototype.write=function(e,t){console.log(n(t)+": "+e)},e}();e.LogConsole=s;var o=function(){function e(e){this.area=e}return e.prototype.write=function(e,t){var r=n(t)+": "+e;this.area.textContent+=r+"\n"},e}();e.LogTextArea=o;var u=function(){function e(e,t){this.log=e,this.level=t}return e.prototype.write=function(e,t){t>this.level&&this.log.write(e,t)},e}();e.LogFilter=u})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(){this.onFinished=null,this.onProgress=null,this.log=new e.LogConsole}return t.prototype._reportError=function(e,t){this.onFinished&&this.onFinished(e,null)},t.prototype._reportSuccess=function(e,t,n){this.onFinished&&this.onFinished(e,t)},t.prototype._reportProgress=function(e,t){this.onProgress&&this.onProgress(e,t.loadedBytes,t.totalBytes)},t.prototype.loadFromXML=function(t,n){var r=new e.Loader.Context;return r.log=this.log,this._loadFromXML(t,n,r)},t.prototype._loadFromXML=function(t,n,r){var i=null;try{i=e.Loader.Document.parse(n,r),r.resolveAllLinks()}catch(s){return r.log.write(s.message,6),this._reportError(t,r),null}return this._reportSuccess(t,i,r),i},t.prototype.loadFromURL=function(t,n){var r=new e.Loader.Context;r.log=this.log;var i=this;if(document!=null&&document.implementation!=null&&document.implementation.createDocument!=null){var s=new XMLHttpRequest;typeof s.overrideMimeType=="function"&&s.overrideMimeType("text/xml"),s.onreadystatechange=function(){if(s.readyState===4){if(s.status===0||s.status===200)if(s.responseXML){var o=e.Loader.Document.parse(s.responseXML,r);i._reportSuccess(t,o,r)}else r.log.write("Empty or non-existing file "+n+".",5),i._reportError(t,r)}else s.readyState===3&&(r.totalBytes>0||(r.totalBytes=parseInt(s.getResponseHeader("Content-Length"))),r.loadedBytes=s.responseText.length,i._reportProgress(t,r))},s.open("GET",n,!0),s.send(null)}else r.log.write("Don't know how to parse XML!",5),i._reportError(t,r)},t}();t.ColladaLoader=n})(t=e.Loader||(e.Loader={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function e(){this.symbols={}}return e}();t.MaterialMap=n;var r=function(){function t(){this.name=null,this.diffuse=null,this.specular=null,this.normal=null}return t.createDefaultMaterial=function(t){var n=t.materials.findConverter(null);return n?n:(n=new e.Converter.Material,t.materials.register(null,n),n)},t.createMaterial=function(t,n){var r=e.Loader.Material.fromLink(t.material,n);if(r===null)return n.log.write("Material not found, material skipped.",4),e.Converter.Material.createDefaultMaterial(n);var i=e.Loader.Effect.fromLink(r.effect,n);if(i===null)return n.log.write("Material effect not found, using default material",4),e.Converter.Material.createDefaultMaterial(n);var s=i.technique;if(s===null)return n.log.write("Material effect not found, using default material",4),e.Converter.Material.createDefaultMaterial(n);s.diffuse!==null&&s.diffuse.color!==null&&n.log.write("Material "+r.id+" contains constant diffuse colors, colors ignored",4),s.specular!==null&&s.specular.color!==null&&n.log.write("Material "+r.id+" contains constant specular colors, colors ignored",4);var o=n.materials.findConverter(r);return o?o:(o=new e.Converter.Material,o.name=r.id,o.diffuse=e.Converter.Texture.createTexture(s.diffuse,n),o.specular=e.Converter.Texture.createTexture(s.specular,n),o.normal=e.Converter.Texture.createTexture(s.bump,n),n.materials.register(r,o),o)},t.getMaterialMap=function(t,n){var r=new e.Converter.MaterialMap,i=0;for(var s=0;s<t.length;s++){var o=t[s],u=o.symbol;if(u===null){n.log.write("Material instance has no symbol, material skipped.",4);continue}if(r.symbols[u]!=null){n.log.write("Material symbol "+u+" used multiple times",5);continue}r.symbols[u]=e.Converter.Material.createMaterial(o,n)}return r},t}();t.Material=r})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t=function(){function e(){}return e.prototype.contructor=function(){},e.round=function(e,t){return t!==null?Math.round(e*Math.pow(10,t))/Math.pow(10,t):e},e.copyNumberArray=function(e,t,n){for(var r=0;r<n;++r)t[r]=e[r]},e.copyNumberArrayOffset=function(e,t,n,r,i){for(var s=0;s<i;++s)n[r+s]=e[t+s]},e.forEachElement=function(e,t,n,r){var i=e.length/t;for(var s=0;s<i;++s)r(e[s*t+n])},e.mat4Extract=function(e,t,n){for(var r=0;r<16;++r)n[r]=e[t*16+r];mat4.transpose(n,n)},e.decompose=function(t,n,r,i){var s=e._decomposeVec3,o=e._decomposeMat3,u=e._decomposeMat4;vec3.set(n,t[12],t[13],t[14]),i[0]=vec3.length(vec3.fromValues(t[0],t[1],t[2])),i[1]=vec3.length(vec3.fromValues(t[4],t[5],t[6])),i[2]=vec3.length(vec3.fromValues(t[8],t[9],t[10])),vec3.set(s,1/i[0],1/i[1],1/i[2]),mat4.scale(u,t,s),mat3.fromMat4(o,u),quat.fromMat3(r,o),quat.normalize(r,r),r[3]=-r[3]},e.compose=function(e,t,n,r){mat4.identity(r),mat4.scale(r,r,n),mat4.fromRotationTranslation(r,t,e)},e.bakeTransform=function(e,t,n,r){var i=vec3.fromValues(e[12],e[13],e[14]);vec3.transformMat4(i,i,r),mat4.multiply(e,n,e),e[12]=i[0],e[13]=i[1],e[14]=i[2]},e.bezier=function(e,t,n,r,i){if(i<0||i>1)throw new Error("Invalid Bezier parameter: "+i);return e*(1-i)*(1-i)*(1-i)+3*t*i*(1-i)*(1-i)+3*n*i*i*(1-i)+r*i*i*i},e.hermite=function(e,t,n,r,i){if(i<0||i>1)throw new Error("Invalid Hermite parameter: "+i);var s=i*i,o=s*i;return e*(2*o-3*s+1)+t*(o-2*s+i)+r*(-2*o+3*s)+n*(o-s)},e.bisect=function(e,t,n,r){var i=0,s=1,o=t(i),u=t(s);if(e<=o)return i;if(e>=u)return s;var a=.5*(i+s),f=t(a),l=0;while(Math.abs(f-e)>n){if(f<e)i=a;else{if(!(f>e))return a;s=a}a=.5*(i+s),f=t(a),++l;if(l>r)throw new Error("Too many iterations")}return a},e.TO_RADIANS=Math.PI/180,e._decomposeVec3=vec3.create(),e._decomposeMat3=mat3.create(),e._decomposeMat4=mat4.create(),e}();e.MathUtils=t})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(){}return e.reIndex=function(e,t,n,r,i,s,o,u,a,f){var l=Math.min(i,f),c=t.length,h=r,p=a;while(h<c){var d=t[h];h+=n;var v=o[p];p+=u;for(var m=0;m<l;++m)s[i*v+m]=e[f*d+m]}},e.compactIndices=function(e,t,n){var r=0,i=e.length/t,s=new Uint32Array(i),o=16777215;for(var u=0;u<i;++u){var a=o;for(var f=0;f<u;++f)if(e[f*t+n]===e[u*t+n]){a=f;break}s[u]=a,a!==o&&r++}var l=new Uint32Array(i),c=0;for(var u=0;u<i;++u){var a=s[u];a===o?(l[u]=c,c++):l[u]=l[a]}return l},e.maxIndex=function(e){if(e===null)return null;var t=-1,n=e.length;for(var r=0;r<n;++r)e[r]>t&&(t=e[r]);return t},e.createFloatArray=function(e,t,n,r){if(e===null)return null;e.stride>n?r.log.write("Source data for "+t+" contains too many dimensions, "+(e.stride-n)+" dimensions will be ignored",4):e.stride<n&&r.log.write("Source data for "+t+" does not contain enough dimensions, "+(n-e.stride)+" dimensions will be zero",4);var i=e.offset,s=e.offset+e.count*e.stride;if(s>e.data.length)return r.log.write("Source for "+t+" tries to access too many elements, data ignored",4),null;if(e.data instanceof Float32Array){var o=e.data,u=new Float32Array(e.count*n),a=e.offset,f=e.stride,l=0,c=n;for(var h=0;h<e.count;++h)for(var p=0;p<n;++p)u[l+c*h+p]=o[a+f*h+p];return u}return r.log.write("Source for "+t+" does not contain floating point data, data ignored",4),null},e.createStringArray=function(e,t,n,r){if(e===null)return null;e.stride>n?r.log.write("Source data for "+t+" contains too many dimensions, "+(e.stride-n)+" dimensions will be ignored",4):e.stride<n&&r.log.write("Source data for "+t+" does not contain enough dimensions, "+(n-e.stride)+" dimensions will be zero",4);var i=e.offset,s=e.offset+e.count*e.stride;if(s>e.data.length)return r.log.write("Source for "+t+" tries to access too many elements, data ignored",4),null;if(e.data instanceof Array){var o=e.data,u=new Array(e.count*n),a=e.offset,f=e.stride,l=0,c=n;for(var h=0;h<e.count;++h)for(var p=0;p<n;++p)u[l+c*h+p]=o[a+f*h+p];return u}return r.log.write("Source for "+t+" does not contain string data, data ignored",4),null},e.spawElements=function(e,t,n){var r=e[t];e[t]=e[n],e[n]=r},e.insertBone=function(t,n,r,i,s,o){if(n[o]<i){n[o]=i,t[o]=r;for(var u=o;u>s;--u)n[u]>n[u-1]&&(e.spawElements(n,u,u-1),e.spawElements(t,u,u-1))}},e.getWorldTransform=function(t){var n=e.worldTransform;return mat4.copy(n,e.getWorldRotation(t)),mat4.scale(n,n,e.getWorldScale(t)),n},e.getWorldInvTransform=function(t){var n=e.getWorldTransform(t);return mat4.invert(e.worldInvTransform,n),e.worldInvTransform},e.getWorldScale=function(t){var n=t.options.worldTransformScale.value;return vec3.set(e.worldScale,n,n,n),e.worldScale},e.getWorldInvScale=function(t){var n=1/t.options.worldTransformScale.value;return vec3.set(e.worldInvScale,n,n,n),e.worldInvScale},e.getWorldRotation=function(t){var n=t.options.worldTransformRotationAxis.value,r=t.options.worldTransformRotationAngle.value*Math.PI/180,i=e.worldRotation;mat4.identity(i);switch(n){case"none":break;case"x":mat4.rotateX(i,i,r);break;case"y":mat4.rotateY(i,i,r);break;case"z":mat4.rotateZ(i,i,r);break;default:t.log.write("Unknown rotation axis",4)}return i},e.worldTransform=mat4.create(),e.worldInvTransform=mat4.create(),e.worldScale=vec3.create(),e.worldInvScale=vec3.create(),e.worldRotation=mat4.create(),e}();e.Utils=t})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(e){this.node=e,this.name=e.name,this.parent=null,this.invBindMatrix=mat4.create(),mat4.identity(this.invBindMatrix),this.attachedToSkin=!1}return t.prototype.clone=function(){var e=new t(this.node);return e.name=this.name,e.parent=this.parent,e.invBindMatrix=mat4.clone(this.invBindMatrix),e.attachedToSkin=this.attachedToSkin,e},t.prototype.depth=function(){return this.parent===null?0:this.parent.depth()+1},t.create=function(t){return new e.Converter.Bone(t)},t.findBoneNode=function(t,n,r){var i=null,s=[];for(var o=0;o<n.length;o++){var u=n[o],a=t.split("/"),f=e.Loader.SidLink.findSidTarget(t,u,a,r);if(f.result!=null){i=f.result;break}s.push(f.warning)}return i===null?(r.log.write("Joint with SID "+t+" not found, joint ignored. Related warnings:\n"+s.join("\n"),4),null):r.isInstanceOf(i,"VisualSceneNode")?i:(r.log.write("Joint "+t+" does not point to a visual scene node, joint ignored",4),null)},t.sameInvBindMatrix=function(e,t,n){if(e===null||t===null)return!1;for(var r=0;r<16;++r){var i=e.invBindMatrix[r],s=t.invBindMatrix[r];if(Math.abs(i-s)>n)return!1}return!0},t.safeToMerge=function(e,n){return e===n?!0:e===null||n===null?!1:e.node!==n.node?!1:e.attachedToSkin&&n.attachedToSkin&&!t.sameInvBindMatrix(e,n,1e-5)?!1:!0},t.mergeBone=function(e,n){return t.safeToMerge(e,n)?e.attachedToSkin?e.clone():n.attachedToSkin?n.clone():e.clone():null},t}();t.Bone=n})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(){this.min=vec3.create(),this.max=vec3.create(),this.reset()}return e.prototype.reset=function(){vec3.set(this.min,Infinity,Infinity,Infinity),vec3.set(this.max,-Infinity,-Infinity,-Infinity)},e.prototype.fromPositions=function(e,t,n){this.reset();for(var r=0;r<n;++r)for(var i=0;i<3;++i){var s=e[(t+r)*3+i];this.min[i]=Math.min(this.min[i],s),this.max[i]=Math.max(this.max[i],s)}},e.prototype.extend=function(e){vec3.max(this.max,this.max,e),vec3.min(this.min,this.min,e)},e.prototype.extendBox=function(e){vec3.max(this.max,this.max,e.max),vec3.min(this.min,this.min,e.min)},e}();e.BoundingBox=t})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function e(){this.indices=null,this.position=null,this.normal=null,this.texcoord=null,this.boneweight=null,this.boneindex=null}return e}();t.GeometryData=n;var r=function(){function e(){this.indices=null,this.indexStride=null,this.indexOffset=null}return e}();t.GeometryChunkSourceIndices=r;var i=function(){function i(){this.name=null,this.vertexCount=null,this.vertexBufferOffset=null,this.triangleCount=null,this.indexBufferOffset=null,this.boundingBox=new t.BoundingBox,this.data=null,this.bindShapeMatrix=null,this._colladaIndices=null}return i.createChunk=function(t,i,s){var o=null,u=null,a=null,f=[];for(var l=0;l<i.inputs.length;l++){var c=i.inputs[l];switch(c.semantic){case"VERTEX":o=c;break;case"NORMAL":u=c;break;case"COLOR":a=c;break;case"TEXCOORD":f.push(c);break;default:s.log.write("Unknown triangles input semantic "+c.semantic+" ignored",4)}}var h=e.Loader.Vertices.fromLink(o.source,s);if(h===null)return s.log.write("Geometry "+t.id+" has no vertices, geometry ignored",4),null;var p=e.Loader.Source.fromLink(u!=null?u.source:null,s),d=e.Loader.Source.fromLink(a!=null?a.source:null,s),v=f.map(function(t){return e.Loader.Source.fromLink(t!=null?t.source:null,s)}),m=null,g=null,y=null,b=[];for(var l=0;l<h.inputs.length;l++){var c=h.inputs[l];switch(c.semantic){case"POSITION":m=c;break;case"NORMAL":g=c;break;case"COLOR":y=c;break;case"TEXCOORD":b.push(c);break;default:s.log.write("Unknown vertices input semantic "+c.semantic+" ignored",4)}}var w=e.Loader.Source.fromLink(m.source,s);if(w===null)return s.log.write("Geometry "+t.id+" has no vertex positions, geometry ignored",4),null;var E=e.Loader.Source.fromLink(g!=null?g.source:null,s),S=e.Loader.Source.fromLink(y!=null?y.source:null,s),x=b.map(function(t){return e.Loader.Source.fromLink(t!=null?t.source:null,s)}),T=e.Converter.Utils.createFloatArray(w,"vertex position",3,s),N=e.Converter.Utils.createFloatArray(E,"vertex normal",3,s),C=e.Converter.Utils.createFloatArray(p,"vertex normal (indexed)",3,s),k=e.Converter.Utils.createFloatArray(S,"vertex color",4,s),L=e.Converter.Utils.createFloatArray(d,"vertex color (indexed)",4,s),A=x.map(function(t){return e.Converter.Utils.createFloatArray(t,"texture coordinate",2,s)}),O=v.map(function(t){return e.Converter.Utils.createFloatArray(t,"texture coordinate (indexed)",2,s)});if(i.type!=="triangles"){var M=i.vcount;if(M)for(var l=0;l<M.length;l++){var _=M[l];if(_!==3)return s.log.write("Geometry "+t.id+" has non-triangle polygons, geometry ignored.",4),null}else s.log.write("Geometry "+t.id+" has polygons with an unknown number of vertices per polygon. Assuming all triangles.",4)}if(w.stride!==3)return s.log.write("Geometry "+t.id+" vertex positions are not 3D vectors, geometry ignored",4),null;var D=i.indices,P=i.count,H=D.length/i.count,B=H/3,j=e.Converter.Utils.compactIndices(D,B,o.offset);if(j===null||j.length===0)return s.log.write("Geometry "+t.id+" does not contain any indices, geometry ignored",5),null;var F=e.Converter.Utils.maxIndex(j)+1,I=j.length/3;if(I!==P)return s.log.write("Geometry "+t.id+" has an inconsistent number of indices, geometry ignored",5),null;var q=new Float32Array(F*3),R=o.offset;e.Converter.Utils.reIndex(T,D,B,R,3,q,j,1,0,3);var U=new Float32Array(F*3),z=u!==null?u.offset:null;N!==null?e.Converter.Utils.reIndex(N,D,B,R,3,U,j,1,0,3):C!==null?e.Converter.Utils.reIndex(C,D,B,z,3,U,j,1,0,3):s.log.write("Geometry "+t.id+" has no normal data, using zero vectors",4);var W=new Float32Array(F*2),X=f.length>0?f[0].offset:null;A.length>0?e.Converter.Utils.reIndex(A[0],D,B,R,2,W,j,1,0,2):O.length>0?e.Converter.Utils.reIndex(O[0],D,B,X,2,W,j,1,0,2):s.log.write("Geometry "+t.id+" has no texture coordinate data, using zero vectors",4);var V=new n;V.indices=j,V.position=q,V.normal=U,V.texcoord=W;var $=new r;$.indices=D,$.indexStride=B,$.indexOffset=R;var J=new e.Converter.GeometryChunk;return J.vertexCount=F,J.vertexBufferOffset=0,J.triangleCount=I,J.indexBufferOffset=0,J.data=V,J._colladaIndices=$,J},i.computeBoundingBox=function(e,t){e.boundingBox.fromPositions(e.data.position,e.vertexBufferOffset,e.vertexCount)},i.transformChunk=function(e,t,n,r){var i=e.data.position;i!==null&&vec3.forEach(i,3,0,i.length/3,vec3.transformMat4,t);var s=e.data.normal;s!==null&&vec3.forEach(s,3,0,s.length/3,vec3.transformMat3,n)},i.scaleChunk=function(e,t,n){var r=e.data.position;if(r!==null)for(var i=0;i<r.length;++i)r[i]=r[i]*t},i.mergeChunkData=function(t,r){if(t.length<2)return;var i=0,s=0,o=t.length>0,u=t.length>0,a=t.length>0,f=t.length>0,l=t.length>0;for(var c=0;c<t.length;++c){var h=t[c],p=h.data;i+=h.vertexCount,s+=h.triangleCount,o=o&&p.position!==null,u=u&&p.normal!==null,a=a&&p.texcoord!==null,f=f&&p.boneweight!==null,l=l&&p.boneindex!==null}var d=new n;d.indices=new Uint32Array(s*3),o&&(d.position=new Float32Array(i*3)),u&&(d.normal=new Float32Array(i*3)),a&&(d.texcoord=new Float32Array(i*2)),l&&(d.boneindex=new Uint8Array(i*4)),f&&(d.boneweight=new Float32Array(i*4));var v=0,m=0;for(var c=0;c<t.length;++c){var h=t[c],p=h.data;for(var g=0;g<h.triangleCount*3;++g)d.indices[v+g]=p.indices[g+h.indexBufferOffset]+m;o&&e.MathUtils.copyNumberArrayOffset(p.position,h.vertexBufferOffset*3,d.position,m*3,h.vertexCount*3),u&&e.MathUtils.copyNumberArrayOffset(p.normal,h.vertexBufferOffset*3,d.normal,m*3,h.vertexCount*3),a&&e.MathUtils.copyNumberArrayOffset(p.texcoord,h.vertexBufferOffset*2,d.texcoord,m*2,h.vertexCount*2),f&&e.MathUtils.copyNumberArrayOffset(p.boneweight,h.vertexBufferOffset*4,d.boneweight,m*4,h.vertexCount*4),l&&e.MathUtils.copyNumberArrayOffset(p.boneindex,h.vertexBufferOffset*4,d.boneindex,m*4,h.vertexCount*4),h.data=d,h.vertexBufferOffset=m,h.indexBufferOffset=v,m+=h.vertexCount,v+=h.triangleCount*3}},i}();t.GeometryChunk=i})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){this.name="",this.chunks=[],this.skeleton=null,this.boundingBox=new t.BoundingBox}return n.prototype.getSkeleton=function(){return this.skeleton},n.createStatic=function(t,n,r){var i=e.Loader.Geometry.fromLink(t.geometry,r);if(i===null)return r.log.write("Geometry instance has no geometry, mesh ignored",4),null;var s=e.Converter.Geometry.createGeometry(i,t.materials,r);return r.options.createSkeleton.value&&e.Converter.Geometry.addSkeleton(s,n,r),s},n.createAnimated=function(t,n,r){var i=e.Loader.Controller.fromLink(t.controller,r);return i===null?(r.log.write("Controller instance has no controller, mesh ignored",4),null):i.skin!==null?e.Converter.Geometry.createSkin(t,i,r):i.morph!==null?e.Converter.Geometry.createMorph(t,i,r):null},n.createSkin=function(r,i,s){var i=e.Loader.Controller.fromLink(r.controller,s);if(i===null)return s.log.write("Controller instance has no controller, mesh ignored",5),null;var o=i.skin;if(o===null)return s.log.write("Controller has no skin, mesh ignored",5),null;var u=e.Loader.Geometry.fromLink(o.source,s);if(u===null)return s.log.write("Controller has no geometry, mesh ignored",5),null;var a=e.Converter.Geometry.createGeometry(u,r.materials,s);if(!s.options.createSkeleton.value)return s.log.write("Geometry "+a.name+" contains skinning data, but the creation of skeletons is disabled in the options. Using static geometry only.",4),a;var f=e.Converter.Geometry.getSkeletonRootNodes(r.skeletons,s);if(f.length===0)return s.log.write("Controller still has no skeleton, using unskinned geometry",4),a;var l=o.joints;if(l===null)return s.log.write("Skin has no joints element, using unskinned mesh",4),a;var c=l.joints;if(c===null)return s.log.write("Skin has no joints input, using unskinned mesh",4),a;var h=e.Loader.Source.fromLink(c.source,s);if(h===null)return s.log.write("Skin has no joints source, using unskinned mesh",4),a;var p=h.data,d=null;o.bindShapeMatrix!==null&&(d=mat4.create(),e.MathUtils.mat4Extract(o.bindShapeMatrix,0,d));var v=l.invBindMatrices;if(v===null)return s.log.write("Skin has no inverse bind matrix input, using unskinned mesh",4),a;var m=e.Loader.Source.fromLink(v.source,s);if(h===null)return s.log.write("Skin has no inverse bind matrix source, using unskinned mesh",4),a;if(m.data.length!==h.data.length*16)return s.log.write("Skin has an inconsistent length of joint data sources, using unskinned mesh",4),a;if(m.data instanceof Float32Array){var g=m.data,y=o.vertexWeights;if(y===null)return s.log.write("Skin contains no bone weights element, using unskinned mesh",4),a;var b=y.weights;if(b===null)return s.log.write("Skin contains no bone weights input, using unskinned mesh",4),a;var w=e.Loader.Source.fromLink(b.source,s);if(w===null)return s.log.write("Skin has no bone weights source, using unskinned mesh",4),a;if(
w.data instanceof Float32Array){var E=w.data;if(o.vertexWeights.joints.source.url!==o.joints.joints.source.url)return s.log.write("Skin uses different data sources for joints in <joints> and <vertex_weights>, this is not supported. Using unskinned mesh.",4),a;var S=t.Skeleton.createFromSkin(p,f,d,g,s);if(S.bones.length===0)return s.log.write("Skin contains no bones, using unskinned mesh",4),a;n.setSkeleton(a,S,s);var x=4,T=e.Converter.Geometry.compactSkinningData(o,E,x,s),N=T.indices,C=T.weights;for(var k=0;k<a.chunks.length;++k){var L=a.chunks[k],A=L.data,O=L._colladaIndices;A.boneindex=new Uint8Array(L.vertexCount*x),e.Converter.Utils.reIndex(N,O.indices,O.indexStride,O.indexOffset,x,A.boneindex,A.indices,1,0,x),A.boneweight=new Float32Array(L.vertexCount*x),e.Converter.Utils.reIndex(C,O.indices,O.indexStride,O.indexOffset,x,A.boneweight,A.indices,1,0,x)}for(var k=0;k<a.chunks.length;++k){var L=a.chunks[k];L.bindShapeMatrix=mat4.clone(d)}return s.options.applyBindShape.value===!0&&n.applyBindShapeMatrices(a,s),s.options.sortBones.value&&(S=e.Converter.Skeleton.sortBones(S,s)),e.Converter.Geometry.setSkeleton(a,S,s),a}return s.log.write("Bone weights data does not contain floating point data, using unskinned mesh",4),a}return s.log.write("Skin inverse bind matrices data does not contain floating point data, using unskinned mesh",4),a},n.compactSkinningData=function(e,n,r,i){var s=e.vertexWeights.v,o=e.vertexWeights.vcount,u=o.length,a=new Float32Array(u*r),f=new Uint8Array(u*r),l=0,c=0,h=0,p=new Float32Array(32);for(var d=0;d<u;++d){var v=o[d];v>r&&c++,p[Math.min(v,p.length-1)]++;for(var m=0;m<v;++m){var g=s[l],y=s[l+1];l+=2;var b=n[y],w=d*r,E=d*r+r-1;t.Utils.insertBone(f,a,g,b,w,E)}var S=0;for(var m=0;m<r;++m)S+=a[d*r+m];if(S<1e-6||S>1e6)h++;else for(var m=0;m<v;++m)a[d*r+m]/=S}return c>0&&i.log.write(""+c+" vertices are influenced by too many bones, some influences were ignored. Only "+r+" bones per vertex are supported.",4),h>0&&i.log.write(""+h+" vertices have zero or infinite total weight, skin will be broken.",4),{weights:a,indices:f}},n.getSkeletonRootNodes=function(t,n){var r=[];for(var i=0;i<t.length;i++){var s=t[i],o=e.Loader.VisualSceneNode.fromLink(s,n);if(o===null){n.log.write("Skeleton root node "+s.getUrl()+" not found, skeleton root ignored",4);continue}r.push(o)}return r.length===0&&(n.log.write("Controller has no skeleton, using the whole scene as the skeleton root",4),r=n.nodes.collada.filter(function(e){return n.isInstanceOf(e.parent,"VisualScene")})),r},n.createMorph=function(e,t,n){return n.log.write("Morph animated meshes not supported, mesh ignored",4),null},n.createGeometry=function(t,n,r){var i=e.Converter.Material.getMaterialMap(n,r),s=new e.Converter.Geometry;s.name=t.name||t.id||t.sid||"geometry";var o=t.triangles;for(var u=0;u<o.length;u++){var a=o[u],f;a.material!==null?(f=i.symbols[a.material],f===null&&(r.log.write("Material symbol "+a.material+" has no bound material instance, using default material",4),f=e.Converter.Material.createDefaultMaterial(r))):(r.log.write("Missing material index, using default material",4),f=e.Converter.Material.createDefaultMaterial(r));var l=e.Converter.GeometryChunk.createChunk(t,a,r);l!==null&&(l.name=s.name,o.length>1&&(l.name+=" #"+u),l.material=f,s.chunks.push(l))}return s},n.transformGeometry=function(e,n,r){var i=mat3.create();mat3.normalFromMat4(i,n);for(var s=0;s<e.chunks.length;++s){var o=e.chunks[s];t.GeometryChunk.transformChunk(o,n,i,r)}},n.setupWorldTransform=function(e,n){if(e.skeleton===null)return;e.skeleton.bones.forEach(function(e){n.options.worldTransformBake&&mat4.multiply(e.invBindMatrix,e.invBindMatrix,t.Utils.getWorldInvTransform(n));if(n.options.worldTransformUnitScale){var r=mat4.create();mat4.invert(r,e.node.transformation_post),mat4.multiply(e.invBindMatrix,r,e.invBindMatrix)}})},n.scaleGeometry=function(e,n,r){for(var i=0;i<e.chunks.length;++i){var s=e.chunks[i];t.GeometryChunk.scaleChunk(s,n,r)}e.skeleton!==null&&e.skeleton.bones.forEach(function(e){e.invBindMatrix[12]*=n,e.invBindMatrix[13]*=n,e.invBindMatrix[14]*=n})},n.applyBindShapeMatrices=function(e,n){for(var r=0;r<e.chunks.length;++r){var i=e.chunks[r],s=i.bindShapeMatrix;if(s){var o=mat3.create();mat3.normalFromMat4(o,s),t.GeometryChunk.transformChunk(i,s,o,n),mat4.identity(i.bindShapeMatrix)}}},n.computeBoundingBox=function(e,n){e.boundingBox.reset();for(var r=0;r<e.chunks.length;++r){var i=e.chunks[r];t.GeometryChunk.computeBoundingBox(i,n),e.boundingBox.extendBox(i.boundingBox)}},n.addSkeleton=function(t,n,r){var i=e.Converter.Skeleton.createFromNode(n,r);e.Converter.Geometry.setSkeleton(t,i,r);for(var s=0;s<t.chunks.length;++s){var o=t.chunks[s],u=o.data;u.boneindex=new Uint8Array(o.vertexCount*4),u.boneweight=new Float32Array(o.vertexCount*4);for(var a=0;a<o.vertexCount;++a)u.boneindex[4*a+0]=0,u.boneindex[4*a+1]=0,u.boneindex[4*a+2]=0,u.boneindex[4*a+3]=0,u.boneweight[4*a+0]=1,u.boneweight[4*a+1]=0,u.boneweight[4*a+2]=0,u.boneweight[4*a+3]=0}r.options.sortBones.value&&(i=e.Converter.Skeleton.sortBones(i,r)),e.Converter.Geometry.setSkeleton(t,i,r)},n.mergeGeometries=function(n,r){if(n.length===0)return r.log.write("No geometries to merge",4),null;if(n.length===1)return n[0];var i=new e.Converter.Geometry;i.name="merged_geometry";var s=new t.Skeleton([]);return n.forEach(function(t){t.skeleton!==null&&(s=e.Converter.Skeleton.mergeSkeletons(s,t.skeleton,r))}),r.options.sortBones.value&&(s=e.Converter.Skeleton.sortBones(s,r)),e.Converter.Geometry.setSkeleton(i,s,r),n.forEach(function(t){e.Converter.Geometry.setSkeleton(t,s,r)}),n.forEach(function(e){i.chunks=i.chunks.concat(e.chunks)}),n.forEach(function(e){e.chunks=[]}),i},n.setSkeleton=function(t,n,r){if(t.skeleton!==null){var i=e.Converter.Skeleton.getBoneIndexMap(t.skeleton,n);for(var s=0;s<t.chunks.length;++s){var o=t.chunks[s],u=o.data.boneindex;if(u!==null)for(var a=0;a<u.length;++a)u[a]=i[u[a]]}}t.skeleton=n},n}();t.Geometry=n})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function e(){this.beginTime=new r,this.endTime=new r,this.duration=new r,this.keyframes=new r,this.fps=new r}return e.prototype.addDataPoint=function(e,t,n){var r=t-e;this.beginTime.addDataPoint(e),this.endTime.addDataPoint(t),this.duration.addDataPoint(r),this.keyframes.addDataPoint(n);if(r>0){var i=(n-1)/r;this.fps.addDataPoint(i)}},e}();t.AnimationTimeStatistics=n;var r=function(){function e(){this.data=[],this.sorted=!0}return e.prototype.addDataPoint=function(e){this.data.push(e),this.sorted=!1},e.prototype.sort=function(){this.sorted||(this.sorted=!0,this.data=this.data.sort(function(e,t){return e-t}))},e.prototype.compute=function(e){return this.data.length>0?(this.sort(),e(this.data)):null},e.prototype.count=function(){return this.compute(function(e){return e.length})},e.prototype.min=function(){return this.compute(function(e){return e[0]})},e.prototype.max=function(){return this.compute(function(e){return e[e.length-1]})},e.prototype.median=function(){var e=this;return this.compute(function(t){var n=(e.data.length-1)/2,r=e.data[Math.floor(n)],i=e.data[Math.ceil(n)];return(r+i)/2})},e.prototype.sum=function(){return this.compute(function(e){return e.reduce(function(e,t){return e+t},0)})},e.prototype.mean=function(){var e=this;return this.compute(function(t){return e.sum()/e.count()})},e}();t.Statistics=r;var i=function(){function t(){this.id=null,this.name=null,this.channels=[]}return t.create=function(t,n){var r=new e.Converter.Animation;return r.id=t.id,r.name=t.name,e.Converter.Animation.addChannelsToAnimation(t,r,n),r},t.addChannelsToAnimation=function(t,n,r){for(var i=0;i<t.channels.length;++i){var s=e.Converter.AnimationChannel.create(t.channels[i],r);n.channels.push(s)}for(var i=0;i<t.children.length;++i){var o=t.children[i];e.Converter.Animation.addChannelsToAnimation(o,n,r)}},t.getTimeStatistics=function(e,t,n,r,i){for(var s=0;s<e.channels.length;++s){var o=e.channels[s];if(o){var u=t!==null?t:-Infinity;u=Math.min(Math.max(u,0),o.input.length-1);var a=n!==null?n:Infinity;a=Math.min(Math.max(a,0),o.input.length-1);var f=o.input[u],l=o.input[a],c=a-u+1;r.addDataPoint(f,l,c)}}},t}();t.Animation=i})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(){this.target=null,this.interpolation=null,this.input=null,this.output=null,this.inTangent=null,this.outTangent=null,this.dataOffset=null,this.dataCount=null}return t.prototype.findInputIndices=function(e,t){var n=this.input,r=function(e){var n=t.messageCount["findInputIndices-invalidTime"]||0;n<10?t.log.write(e,4):n==10&&t.log.write("Further warnings about invalid time suppressed.",4),t.messageCount["findInputIndices-invalidTime"]=n+1};if(n.length===1)return e!==n[0]&&r("Resampling input with only one keyframe: t="+e+", t_begin="+n[0]+", using first keyframe"),{i0:0,i1:0};if(e<n[0])return r("Invalid time for resampling: t="+e+", t_begin="+n[0]+", using first keyframe"),{i0:0,i1:1};if(e>n[n.length-1])return r("Invalid time for resampling: t="+e+", t_end="+n[n.length-1]+", using last keyframe"),{i0:n.length-2,i1:n.length-1};for(var i=0;i<n.length-1;++i){var s=n[i],o=n[i+1];if(s<=e&&e<=o)return{i0:i,i1:i+1}}return t.log.write("Keyframes for time "+e+"not found, using first keyframe",4),{i0:0,i1:1}},t.createInputData=function(t,n,r,i){if(t===null)return null;var s=e.Loader.Source.fromLink(t.source,i);return s===null?(i.log.write("Animation channel has no "+n+" input data, data ignored",4),null):r!=s.stride?(i.log.write("Animation channel has a nonstandard dimensionality for "+n+", data ignored",4),null):e.Converter.Utils.createFloatArray(s,n,r,i)},t.createInputDataFromArray=function(t,n,r,i){return t.length>0?(t.length>1&&i.log.write("Animation channel has more than one "+n+" input, using only the first one",4),e.Converter.AnimationChannel.createInputData(t[0],n,r,i)):null},t.create=function(t,n){var r=new e.Converter.AnimationChannel,i=e.Loader.Element.fromLink(t.target,n);if(i===null)return n.log.write("Animation channel has an invalid target '"+t.target.url+"', animation ignored",4),null;var s=n.animationTargets.findConverter(i);if(s===null)return n.log.write("Animation channel has no converter target '"+t.target.url+"', animation ignored",4),null;r.target=s;var o=e.Loader.Sampler.fromLink(t.source,n);if(o===null)return n.log.write("Animation channel has an invalid sampler '"+t.source.url+"', animation ignored",4),null;var u=s.getTargetDataRows(),a=s.getTargetDataColumns(),f=u*a,l=t.target;if(l.dotSyntax){r.dataCount=1;switch(l.member){case"X":r.dataOffset=0;break;case"Y":r.dataOffset=1;break;case"Z":r.dataOffset=2;break;case"W":r.dataOffset=3;break;case"R":r.dataOffset=0;break;case"G":r.dataOffset=1;break;case"B":r.dataOffset=2;break;case"U":r.dataOffset=0;break;case"V":r.dataOffset=1;break;case"S":r.dataOffset=0;break;case"T":r.dataOffset=1;break;case"P":r.dataOffset=2;break;case"Q":r.dataOffset=3;break;case"ANGLE":r.dataOffset=3;break;default:return n.log.write("Unknown semantic for '"+l.url+"', animation ignored",4),null}}else if(t.target.arrSyntax){r.dataCount=1;switch(l.indices.length){case 1:r.dataOffset=l.indices[0];break;case 2:r.dataOffset=l.indices[0]*u+l.indices[1];break;default:return n.log.write("Invalid number of indices for '"+l.url+"', animation ignored",4),null}}else r.dataOffset=0,r.dataCount=a*u;r.input=e.Converter.AnimationChannel.createInputData(o.input,"input",1,n),r.output=e.Converter.AnimationChannel.createInputDataFromArray(o.outputs,"output",r.dataCount,n),r.inTangent=e.Converter.AnimationChannel.createInputDataFromArray(o.inTangents,"intangent",r.dataCount+1,n),r.outTangent=e.Converter.AnimationChannel.createInputDataFromArray(o.outTangents,"outtangent",r.dataCount+1,n);if(r.input===null)return n.log.write("Animation channel has no input data, animation ignored",4),null;if(r.output===null)return n.log.write("Animation channel has no output data, animation ignored",4),null;var c=o.interpolation;if(c===null)return n.log.write("Animation channel has no interpolation input, animation ignored",4),null;var h=e.Loader.Source.fromLink(c.source,n);return h===null?(n.log.write("Animation channel has no interpolation source, animation ignored",4),null):(r.interpolation=e.Converter.Utils.createStringArray(h,"interpolation type",1,n),s.registerAnimation(r),r)},t.interpolateLinear=function(e,t,n,r,i,s,o,u,a){var f=(e-t)/(n-t);for(var l=0;l<s;++l){var c=u.output[r*s+l],h=u.output[i*s+l];a[o+l]=c+f*(h-c)}},t.interpolateBezier=function(t,n,r,i,s,o,u,a,f){var l=a.outTangent[i*(o+1)],c=a.inTangent[s*(o+1)],h=Math.abs(r-n)*1e-4,p=e.MathUtils.bisect(t,function(t){return e.MathUtils.bezier(n,l,c,r,t)},h,100),d=Math.abs(t-e.MathUtils.bezier(n,l,c,r,p));for(var v=0;v<o;++v){var m=a.output[i*o+v],g=a.output[s*o+v],y=a.outTangent[i*(o+1)+v+1],b=a.inTangent[s*(o+1)+v+1];f[u+v]=e.MathUtils.bezier(m,y,b,g,p)}},t.interpolateHermite=function(t,n,r,i,s,o,u,a,f){var l=a.outTangent[i*(o+1)],c=a.inTangent[s*(o+1)],h=Math.abs(r-n)*1e-5,p=e.MathUtils.bisect(t,function(t){return e.MathUtils.hermite(n,l,c,r,t)},h,100);for(var d=0;d<o;++d){var v=a.output[i*o+d],m=a.output[s*o+d],n=a.outTangent[i*(o+1)+d+1],r=a.inTangent[s*(o+1)+d+1];f[u+d]=e.MathUtils.hermite(v,n,r,m,p)}},t.applyToData=function(t,n,r,i){if(t.input===null||t.output===null)return;var s=t.findInputIndices(r,i),o=s.i0,u=s.i1,a=t.input[o],f=t.input[u],l=t.dataCount,c=t.dataOffset,h=t.interpolation[s.i0];o===u&&(h="STEP");switch(h){case"STEP":for(var p=0;p<l;++p)n[c+p]=t.output[o*l+p];break;case"LINEAR":e.Converter.AnimationChannel.interpolateLinear(r,a,f,o,u,l,c,t,n);break;case"BEZIER":t.inTangent!==null&&t.outTangent!==null?e.Converter.AnimationChannel.interpolateBezier(r,a,f,o,u,l,c,t,n):e.Converter.AnimationChannel.interpolateLinear(r,a,f,o,u,l,c,t,n);break;case"HERMITE":t.inTangent!==null&&t.outTangent!==null?e.Converter.AnimationChannel.interpolateHermite(r,a,f,o,u,l,c,t,n):e.Converter.AnimationChannel.interpolateLinear(r,a,f,o,u,l,c,t,n);break;case"CARDINAL":case"BSPLINE":i.log.write("Interpolation type "+h+" not supported, using STEP",4);for(var p=0;p<l;++p)n[c+p]=t.input[o*l+p];break;default:i.log.write("Unknown interpolation type "+h+" at time "+r+", using STEP",4);for(var p=0;p<l;++p)n[c+p]=t.input[o*l+p]}},t}();t.AnimationChannel=n})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){(function(e){e[e.Translation=1]="Translation",e[e.Rotation=2]="Rotation",e[e.Scale=3]="Scale"})(t.TransformType||(t.TransformType={}));var n=t.TransformType,r=function(){function t(e,t,n){this.rows=t,this.colums=n,this.channels=[];var r=t*n;this.data=new Float32Array(r),this.original_data=new Float32Array(r);for(var i=0;i<r;++i)this.data[i]=e.data[i],this.original_data[i]=e.data[i]}return t.prototype.getTargetDataRows=function(){return this.rows},t.prototype.getTargetDataColumns=function(){return this.colums},t.prototype.applyAnimation=function(t,n,r){e.Converter.AnimationChannel.applyToData(t,this.data,n,r),this.updateFromData()},t.prototype.registerAnimation=function(e){this.channels.push(e)},t.prototype.isAnimated=function(){return this.channels.length>0},t.prototype.isAnimatedBy=function(e){if(e!==null){for(var t=0;t<this.channels.length;++t){var n=this.channels[t];if(e.channels.indexOf(n)!==-1)return!0}return!1}return this.channels.length>0},t.prototype.resetAnimation=function(){for(var e=0;e<this.data.length;++e)this.data[e]=this.original_data[e];this.updateFromData()},t.prototype.applyTransformation=function(e){throw new Error("Not implemented")},t.prototype.updateFromData=function(){throw new Error("Not implemented")},t.prototype.hasTransformType=function(e){throw new Error("Not implemented")},t}();t.Transform=r;var i=function(t){function n(e){t.call(this,e,4,4),this.matrix=mat4.create(),this.updateFromData()}return __extends(n,t),n.prototype.updateFromData=function(){e.MathUtils.mat4Extract(this.data,0,this.matrix)},n.prototype.applyTransformation=function(e){mat4.multiply(e,e,this.matrix)},n.prototype.hasTransformType=function(e){return!0},n}(r);t.TransformMatrix=i;var s=function(e){function t(t){e.call(this,t,4,1),this.axis=vec3.create(),this.radians=0,this.updateFromData()}return __extends(t,e),t.prototype.updateFromData=function(){vec3.set(this.axis,this.data[0],this.data[1],this.data[2]),this.radians=this.data[3]/180*Math.PI},t.prototype.applyTransformation=function(e){mat4.rotate(e,e,this.radians,this.axis)},t.prototype.hasTransformType=function(e){return e===2},t}(r);t.TransformRotate=s;var o=function(e){function t(t){e.call(this,t,3,1),this.pos=vec3.create(),this.updateFromData()}return __extends(t,e),t.prototype.updateFromData=function(){vec3.set(this.pos,this.data[0],this.data[1],this.data[2])},t.prototype.applyTransformation=function(e){mat4.translate(e,e,this.pos)},t.prototype.hasTransformType=function(e){return e===1},t}(r);t.TransformTranslate=o;var u=function(e){function t(t){e.call(this,t,3,1),this.scl=vec3.create(),this.updateFromData()}return __extends(t,e),t.prototype.updateFromData=function(){vec3.set(this.scl,this.data[0],this.data[1],this.data[2])},t.prototype.applyTransformation=function(e){mat4.scale(e,e,this.scl)},t.prototype.hasTransformType=function(e){return e===3},t}(r);t.TransformScale=u})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){this.name="",this.parent=null,this.children=[],this.geometries=[],this.transformations=[],this.matrix=mat4.create(),this.worldMatrix=mat4.create(),this.initialLocalMatrix=mat4.create(),this.initialWorldMatrix=mat4.create(),this.transformation_pre=mat4.create(),mat4.identity(this.transformation_pre),this.transformation_post=mat4.create(),mat4.identity(this.transformation_post)}return n.prototype.addTransform=function(n){var r=new e.Loader.NodeTransform;r.data=n,r.type="matrix",r.name="virtual static transform";var i=new t.TransformMatrix(r);this.transformations.unshift(i)},n.prototype.getWorldMatrix=function(e){return this.parent!=null?mat4.multiply(this.worldMatrix,this.parent.getWorldMatrix(e),this.getLocalMatrix(e)):mat4.copy(this.worldMatrix,this.getLocalMatrix(e)),this.worldMatrix},n.prototype.getLocalMatrix=function(e){mat4.copy(this.matrix,this.transformation_pre);for(var t=0;t<this.transformations.length;t++){var n=this.transformations[t];n.applyTransformation(this.matrix)}return mat4.multiply(this.matrix,this.matrix,this.transformation_post),this.matrix},n.prototype.containsSceneGraphItems=function(){return this.geometries.length>0?!0:!1},n.prototype.isAnimated=function(e){return this.isAnimatedBy(null,e)},n.prototype.isAnimatedBy=function(e,t){for(var n=0;n<this.transformations.length;n++){var r=this.transformations[n];if(r.isAnimatedBy(e))return!0}return t&&this.parent!==null?this.parent.isAnimatedBy(e,t):!1},n.prototype.resetAnimation=function(){for(var e=0;e<this.transformations.length;e++){var t=this.transformations[e];t.resetAnimation()}},n.pruneNodes=function(t,n){for(var r=0;r<t.length;++r){var i=t[r];e.Converter.Node.pruneNodes(i.children,n)}t=t.filter(function(e,t,n){return e.containsSceneGraphItems()||e.children.length>0})},n.createNode=function(t,r,i){var s=new e.Converter.Node;s.parent=r,r&&r.children.push(s),i.nodes.register(t,s),s.name=t.name||t.id||t.sid||"Unnamed node";for(var o=0;o<t.transformations.length;++o){var u=t.transformations[o],a=null;switch(u.type){case"matrix":a=new e.Converter.TransformMatrix(u);break;case"rotate":a=new e.Converter.TransformRotate(u);break;case"translate":a=new e.Converter.TransformTranslate(u);break;case"scale":a=new e.Converter.TransformScale(u);break;default:i.log.write("Transformation type "+u.type+" not supported, transform ignored",4)}a!==null&&(i.animationTargets.register(u,a),s.transformations.push(a))}n.updateInitialMatrices(s,i);for(var o=0;o<t.children.length;o++)var f=t.children[o],l=e.Converter.Node.createNode(f,s,i);return s},n.updateInitialMatrices=function(e,t){e.getLocalMatrix(t),mat4.copy(e.initialLocalMatrix,e.matrix),e.getWorldMatrix(t),mat4.copy(e.initialWorldMatrix,e.worldMatrix)},n.createNodeData=function(t,n){var r=n.nodes.findCollada(t);for(var i=0;i<r.geometries.length;i++){var s=r.geometries[i],o=e.Converter.Geometry.createStatic(s,t,n);t.geometries.push(o)}for(var i=0;i<r.controllers.length;i++){var u=r.controllers[i],o=e.Converter.Geometry.createAnimated(u,t,n);t.geometries.push(o)}r.lights.length>0&&n.log.write("Node "+r.id+" contains lights, lights are ignored",4),r.cameras.length>0&&n.log.write("Node "+r.id+" contains cameras, cameras are ignored",4);for(var i=0;i<t.children.length;i++){var a=t.children[i];e.Converter.Node.createNodeData(a,n)}},n.forEachNode=function(t,n){for(var r=0;r<t.length;++r){var i=t[r];n(i),e.Converter.Node.forEachNode(i.children,n)}},n.extractGeometries=function(t,n){var r=[];e.Converter.Node.forEachNode(t,function(e){for(var t=0;t<e.geometries.length;++t)r.push({node:e,geometry:e.geometries[t]});e.geometries=[]});if(r.length===0){n.log.write("No geometry found in the scene, returning an empty geometry",4);var i=new e.Converter.Geometry;return i.name="empty_geometry",[i]}var s=0,o=0;r.forEach(function(e){e.geometry.getSkeleton()!==null&&s++,e.node.isAnimated(!0)&&o++}),n.options.createSkeleton.value||(s>0&&n.log.write("Scene contains "+s+" skinned geometries, but skeleton creation is disabled. Static geometry was generated.",4),o>0&&n.log.write("Scene contains "+o+" static geometries attached to animated nodes, but skeleton creation is disabled. Static geometry was generated.",4),r.forEach(function(t){var r=t.node.getWorldMatrix(n);if(n.options.worldTransformUnitScale){var i=mat4.create();mat4.invert(i,t.node.transformation_post),mat4.multiply(r,r,i)}e.Converter.Geometry.transformGeometry(t.geometry,r,n)}));if(n.options.singleGeometry){var u=r.map(function(e){return e.geometry}),i=e.Converter.Geometry.mergeGeometries(u,n);return[i]}return r.map(function(e){return e.geometry})},n.setupWorldTransform=function(e,r){var i=t.Utils.getWorldScale(r),s=t.Utils.getWorldInvScale(r),o=t.Utils.getWorldRotation(r),u=t.Utils.getWorldTransform(r),a=r.options.worldTransformUnitScale.value;e.parent==null?mat4.copy(e.transformation_pre,u):a&&mat4.invert(e.transformation_pre,e.parent.transformation_post),a&&(mat4.identity(e.transformation_post),mat4.scale(e.transformation_post,e.transformation_post,s)),n.updateInitialMatrices(e,r);for(var f=0;f<e.children.length;++f)n.setupWorldTransform(e.children[f],r)},n}();t.Node=n})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(e){this.id=e.id,this.url=""}return t.createTexture=function(t,n){if(t===null)return null;if(t.textureSampler===null)return null;var r=e.Loader.EffectParam.fromLink(t.textureSampler,n);if(r===null)return n.log.write("Texture sampler not found, texture will be missing",4),null;var i=r.sampler;if(i===null)return n.log.write("Texture sampler param has no sampler, texture will be missing",4),null;var s=null;if(i.image!=null){s=e.Loader.Image.fromLink(i.image,n);if(s===null)return n.log.write("Texture image not found, texture will be missing",4),null}else if(i.surface!=null){var o=e.Loader.EffectParam.fromLink(i.surface,n);if(o===null)return n.log.write("Texture surface not found, texture will be missing",4),null;var u=o.surface;if(u===null)return n.log.write("Texture surface param has no surface, texture will be missing",4),null;s=e.Loader.Image.fromLink(u.initFrom,n);if(s===null)return n.log.write("Texture image not found, texture will be missing",4),null}var a=n.textures.findConverter(s);return a?a:(a=new e.Converter.Texture(s),a.url=s.initFrom,n.options.removeTexturePath.value===!0&&(a.url=a.url.replace(/^.*[\\\/]/,"")),n.textures.register(s,a),a)},t}();t.Texture=n})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function e(){this.collada=[],this.converter=[]}return e.prototype.register=function(e,t){this.collada.push(e),this.converter.push(t)},e.prototype.findConverter=function(e){for(var t=0;t<this.collada.length;++t)if(this.collada[t]===e)return this.converter[t];return null},e.prototype.findCollada=function(e){for(var t=0;t<this.collada.length;++t)if(this.converter[t]===e)return this.collada[t];return null},e}();t.ObjectMap=n;var r=function(t){function n(n,r){t.call(this),this.log=n,this.options=r,this.materials=new e.Converter.ObjectMap,this.textures=new e.Converter.ObjectMap,this.nodes=new e.Converter.ObjectMap,this.animationTargets=new e.Converter.ObjectMap,this.messageCount={}}return __extends(n,t),n}(e.Context);t.Context=r})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(e,t,n){this.type="boolean",this.title=e,this.value=t,this.description=n}return e}();e.OptionBool=t;var n=function(){function e(e,t,n,r,i){this.type="number",this.title=e,this.value=t,this.min=n,this.max=r,this.description=i}return e}();e.OptionFloat=n;var r=function(){function e(e,t,n,r){this.type="select",this.title=e,this.value=t,this.options=n,this.description=r}return e}();e.OptionSelect=r;var i=function(){function e(e,t,n){this.type="array",this.title=e,this.value=t,this.description=n}return e}();e.OptionArray=i;var s=function(){function e(){this.singleAnimation=new t("Single animation",!0,"Enabled: all animations are merged into a single animation (useful if each bone has a separate top level animation).<br/>Disabled: animations are not merged."),this.singleGeometry=new t("Single geometry",!0,"Enabled: all geometries are merged into a single geometry. Only has an effect if 'enableExtractGeometry' is enabled.<br/>Disabled: geometries are not merged."),this.singleBufferPerGeometry=new t("Single buffer",!1,"Enabled: all chunks within one geometry use one set of vertex buffers, each chunk occupying a different part of the buffer set.<br/>Disabled: each chunk has its own set of buffers."),this.enableAnimations=new t("Animations",!0,"Enabled: animations are exported.<br/>Disabled: all animations are ignored."),this.enableExtractGeometry=new t("Extract geometry",!0,"Enabled: extract all geometries from the scene and detach them from their scene graph nodes.<br/>Disabled: geometries remain attached to nodes."),this.enableResampledAnimations=new t("Resampled animations",!0,"Enabled: generate resampled animations for all skeleton bones.<br/>Disabled: do not generate resampled animations."),this.useAnimationLabels=new t("Animation labels",!1,"Enabled: animations labels are used to split the global animation into separete animations.<br/>Disabled: only one global animation is exported."),this.animationLabels=new i("Animation labels",[],"An array of animation labels ({name, begin, end, fps)} that describes how the global animation is split.<br/>Only has an effect if 'useAnimationLabels' is enabled."),this.animationFps=new n("Animation samples per second",10,0,100,"Default FPS for resampled animations."),this.removeConstAnimationTracks=new t("Remove static animations",!0,"Enabled: animation tracks are removed if they only contain the rest pose transformation for all times.<br/>Disabled: all animation tracks are exported."),this.applyBindShape=new t("Apply bind shape",!0,"Enabled: the positions and normals of skin-animated meshes are pre-multiplied by the bind shape matrix.<br/>Disabled: the bind shape matrix needs to be manually exported and applied during rendering."),this.removeTexturePath=new t("Remove texture path",!0,"Enabled: only the filename and extension of textures are kept and the remaining path is discarded.<br/>Disabled: original texture paths are kept."),this.sortBones=new t("Sort bones",!0,"Enabled: bones are sorted so that child bones always appear after their parent bone in the list of bones.<br/>Disabled: bones appear in their original order."),this.worldTransform=new t("World transform",!1,"Enabled: all objects (geometries, animations, skeletons) are transformed as specified by the corresponding world transform options.<br/>Disabled: the world transform options are ignored."),this.worldTransformBake=new t("Bake world transform",!0,"Enabled: the world transformation is applied to skinned geometry.<br/>Disabled: the world transformation is applied to the bones."),this.worldTransformUnitScale=new t("World transform no node scale",!0,"If enabled, the world scale will not add any scaling transformation to any nodes.The world scale will instead be distributed to the translation part of all local transformations."),this.worldTransformScale=new n("World transform: scale",1,1e-6,1e6,"Scale factor. See the 'worldTransform' option."),this.worldTransformRotationAxis=new r("World transform: rotation axis","none",["none","x","y","z"],"Rotation axis. See the 'worldTransform' option."),this.worldTransformRotationAngle=new n("World transform: rotation angle",0,0,360,"Rotation angle (in degrees). See the 'worldTransform' option."),this.truncateResampledAnimations=new t("Truncate resampled animations",!0,"Enabled: animation durations are truncated in order to keep the requested FPS.<br/>Disabled: requested FPS is slightly modified to keep the original duration."),this.createSkeleton=new t("Generate skeleton",!0,"Enabled: a skeleton is generated and all geometry is attached to skeleton bones.<br/>Disabled: no skeleton is generated and all geometry is static.")}return e}();e.Options=s})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(e){this.bones=e}return n.findBone=function(e,n){for(var r=0;r<e.length;++r)if(t.Bone.safeToMerge(e[r],n))return e[r];return null},n.findParent=function(e,t){if(t.parent===null)return null;for(var n=0;n<e.length;++n)if(e[n].node===t.parent.node)return e[n];return null},n.checkConsistency=function(e,n){e.bones.forEach(function(n,r){e.bones.forEach(function(e,i){if(r!==i&&t.Bone.safeToMerge(n,e))throw new Error("Duplicate bone")})}),e.bones.forEach(function(e){if(e.parent!==null&&e.node.parent===null)throw new Error("Missing parent")}),e.bones.forEach(function(t){if(t.parent!==null&&e.bones.indexOf(t.parent)===-1)throw new Error("Invalid parent")})},n.createFromSkin=function(t,r,i,s,o){var u=[];for(var a=0;a<t.length;a++){var f=t[a],l=e.Converter.Bone.findBoneNode(f,r,o);if(l===null)return o.log.write("Joint "+f+" not found for skeleton, no bones created",4),new n([]);var c=o.nodes.findConverter(l);if(c===null)return o.log.write("Joint "+f+" not converted for skeleton, no bones created",4),new n([]);var h=e.Converter.Bone.create(c);h.attachedToSkin=!0,e.MathUtils.mat4Extract(s,a,h.invBindMatrix),u.push(h)}var p=new n(u);return p=e.Converter.Skeleton.addBoneParents(p,o),n.checkConsistency(p,o),p},n.createFromNode=function(t,r){var i=r.nodes.findCollada(t),s=e.Converter.Bone.create(t);mat4.identity(s.invBindMatrix),s.attachedToSkin=!0;var o=new n([s]);return o=e.Converter.Skeleton.addBoneParents(o,r),n.checkConsistency(o,r),o},n.replaceBone=function(e,t,n){var r=e.slice(0),i=r[t];return r[t]=n,r.forEach(function(e){e.parent===i&&(e.parent=n)}),r},n.mergeBone=function(e,r){for(var i=0;i<e.length;++i)if(t.Bone.safeToMerge(e[i],r)){var s=t.Bone.mergeBone(e[i],r);return n.replaceBone(e,i,s)}var o=e.slice(0),u=r.clone();return o.push(u),u.parent=n.findParent(o,u),o},n.mergeSkeletons=function(e,t,r){var i=[],s=[];e.bones.forEach(function(e){i=n.mergeBone(i,e)}),t.bones.forEach(function(e){i=n.mergeBone(i,e)});var o=new n(i);return n.checkConsistency(o,r),o},n.getSkeletonRootNodes=function(t,n){var r=[];for(var i=0;i<t.length;i++){var s=t[i],o=e.Loader.VisualSceneNode.fromLink(s,n);if(o===null){n.log.write("Skeleton root node "+s.getUrl()+" not found, skeleton root ignored",4);continue}r.push(o)}return r.length===0&&(n.log.write("Controller has no skeleton, using the whole scene as the skeleton root",4),r=n.nodes.collada.filter(function(e){return n.isInstanceOf(e.parent,"VisualScene")})),r},n.addBoneParents=function(t,r){var i=t.bones.slice(0),s=0;while(s<i.length){var o=i[s];++s;for(var u=0;u<i.length;u++){var a=i[u];if(o.node.parent===a.node){o.parent=a;break}}o.node.parent!=null&&o.parent==null&&(o.parent=e.Converter.Bone.create(o.node.parent),i.push(o.parent))}var f=new n(i);return n.checkConsistency(f,r),f},n.getBoneIndexMap=function(t,n){var r=new Uint32Array(t.bones.length);for(var i=0;i<t.bones.length;++i){var s=t.bones[i],o=-1;for(var u=0;u<n.bones.length;++u){var a=n.bones[u];if(e.Converter.Bone.safeToMerge(s,a)){o=u;break}}if(o<0){var f=s.name,l=n.bones.map(function(e){return e.name});throw new Error("Bone "+f+" not found in "+l)}r[i]=o}return r
},n.sortBones=function(e,t){var r=e.bones.slice(0);r=r.sort(function(t,n){var r=t.depth(),i=n.depth();if(r!==i)return r-i;if(t.parent!==n.parent&&t.parent!==null){var s=e.bones.indexOf(t.parent),o=e.bones.indexOf(n.parent);return s-o}var s=e.bones.indexOf(t),o=e.bones.indexOf(n);return s-o});if(r.length!=e.bones.length||n.bonesSorted(r)==0)throw new Error("Error while sorting bones");var i=new n(r);return n.checkConsistency(i,t),i},n.bonesSorted=function(e){var t=0;return e.forEach(function(n){if(n.parent!==null){var r=e.indexOf(n),i=e.indexOf(n.parent);r<i&&++t}}),t===0},n}();t.Skeleton=n})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){function r(e,t,n,r){r.log.write(e+": "+t.mean().toFixed(n)+" ("+"min: "+t.min().toFixed(n)+", "+"med: "+t.median().toFixed(n)+", "+"max: "+t.max().toFixed(n)+")",1)}var n=function(){function e(){this.pos=null,this.rot=null,this.scl=null,this.rel_pos=null,this.rel_rot=null,this.rel_scl=null}return e}();t.AnimationDataTrack=n;var i=function(){function t(){this.name="",this.duration=null,this.keyframes=null,this.fps=null,this.tracks=[]}return t.create=function(t,n,i,s,o,u){var a=new e.Converter.AnimationData;a.name=n.name;var f=n.channels,l=new e.Converter.AnimationTimeStatistics;e.Converter.Animation.getTimeStatistics(n,i,s,l,u),r("Original Duration",l.duration,3,u),r("Original Time Start",l.beginTime,3,u),r("Original Time Stop",l.endTime,3,u),r("Original Keyframes",l.keyframes,3,u),r("Original FPS",l.fps,3,u),o===null&&(o=l.fps.median());if(o===null||o<=0)return u.log.write("Could not determine FPS for animation, skipping animation",4),null;var c=l.beginTime.min(),h=l.endTime.max(),p=h-c,d=Math.max(Math.floor(o*p+1e-4)+1,2);u.options.truncateResampledAnimations.value?p=(d-1)/o:o=(d-1)/p;var v=1/o;u.log.write("Resampled duration: "+p.toFixed(3),1),u.log.write("Resampled keyframes: "+d.toFixed(3),1),u.log.write("Resampled FPS: "+o.toFixed(3),1),a.fps=+o.toFixed(3),a.keyframes=d,a.duration=p,a.original_fps=l.fps.median();if(o>0){if(p>0){if(d>0){for(var m=0;m<t.bones.length;++m){var g=t.bones[m],y=new e.Converter.AnimationDataTrack;y.pos=new Float32Array(d*3),y.rot=new Float32Array(d*4),y.scl=new Float32Array(d*3),y.rel_pos=new Float32Array(d*3),y.rel_rot=new Float32Array(d*4),y.rel_scl=new Float32Array(d*3),a.tracks.push(y)}var b=a.tracks;for(var m=0;m<t.bones.length;++m){var g=t.bones[m];g.node.resetAnimation()}var w=vec3.create(),E=quat.create(),S=vec3.create();for(var x=0;x<d;++x){var T=c+x*v;for(var N=0;N<f.length;++N){var C=f[N];C&&C.target.applyAnimation(C,T,u)}for(var k=0;k<t.bones.length;++k){var g=t.bones[k],y=b[k],L=g.node.getLocalMatrix(u);e.MathUtils.decompose(L,w,E,S);var A=mat4.create();mat4.fromRotationTranslation(A,E,w),y.pos!==null&&(y.pos[x*3+0]=w[0],y.pos[x*3+1]=w[1],y.pos[x*3+2]=w[2]),y.rot!==null&&(y.rot[x*4+0]=E[0],y.rot[x*4+1]=E[1],y.rot[x*4+2]=E[2],y.rot[x*4+3]=E[3]),y.scl!==null&&(y.scl[x*3+0]=S[0],y.scl[x*3+1]=S[1],y.scl[x*3+2]=S[2])}}for(var m=0;m<t.bones.length;++m){var g=t.bones[m];g.node.resetAnimation()}var O=!1,M=vec3.create(),_=vec3.create(),D=quat.create(),P=quat.create(),H=vec3.create(),B=vec3.create();for(var k=0;k<t.bones.length;++k){var g=t.bones[k],y=b[k],j=g.node.getLocalMatrix(u);e.MathUtils.decompose(j,M,D,H),quat.invert(P,D),vec3.negate(_,M),vec3.set(B,1/H[0],1/H[1],1/H[2]);var F=0,I=0,q=0,R=0,U=0,z=0;for(var x=0;x<d;++x)w[0]=y.pos[x*3+0],w[1]=y.pos[x*3+1],w[2]=y.pos[x*3+2],vec3.add(w,_,w),F=vec3.length(w),R=Math.max(R,F),E[0]=y.rot[x*4+0],E[1]=y.rot[x*4+1],E[2]=y.rot[x*4+2],E[3]=y.rot[x*4+3],quat.multiply(E,P,E),I=2*Math.acos(Math.min(Math.max(E[3],-1),1)),U=Math.max(U,I),S[0]=y.scl[x*3+0],S[1]=y.scl[x*3+1],S[2]=y.scl[x*3+2],vec3.multiply(S,B,S),q=Math.max(Math.abs(1-S[0]),Math.abs(1-S[1]),Math.abs(1-S[2])),z=Math.max(z,q),y.rel_pos[x*3+0]=w[0],y.rel_pos[x*3+1]=w[1],y.rel_pos[x*3+2]=w[2],y.rel_scl[x*3+0]=S[0],y.rel_scl[x*3+1]=S[1],y.rel_scl[x*3+2]=S[2],y.rel_rot[x*4+0]=E[0],y.rel_rot[x*4+1]=E[1],y.rel_rot[x*4+2]=E[2],y.rel_rot[x*4+3]=E[3];if(u.options.removeConstAnimationTracks.value===!0){var W=1e-4,X=.05,V=.5;R<W&&(y.pos=null,y.rel_pos=null),U<X&&(y.rot=null,y.rel_rot=null),z<V&&(y.scl=null,y.rel_scl=null)}}return a}return u.log.write("Invalid number of keyframes: "+d+", skipping animation",4),null}return u.log.write("Invalid duration: "+p+", skipping animation",4),null}return u.log.write("Invalid FPS: "+o+", skipping animation",4),null},t.createFromLabels=function(t,n,r,i,s){if(t===null)return s.log.write("No skeleton present, no animation data generated.",4),[];var o=[];for(var u=0;u<r.length;++u){var a=r[u],f=e.Converter.AnimationData.create(t,n,a.begin,a.end,a.fps||i,s);f!==null&&(f.name=a.name,o.push(f))}return o},t}();t.AnimationData=i})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(){this.nodes=[],this.animations=[],this.geometries=[],this.resampled_animations=[]}return e}();e.Document=t})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){this.log=new e.LogConsole,this.options=new e.Converter.Options}return n.prototype.forEachGeometry=function(t,n){for(var r=0;r<t.geometries.length;++r)n(t.geometries[r]);e.Converter.Node.forEachNode(t.nodes,function(e){for(var t=0;t<e.geometries.length;++t)n(e.geometries[t])})},n.prototype.convert=function(r){var i=this,s=new e.Converter.Context(this.log,this.options);if(r===null)return s.log.write("No document to convert",4),null;var o=new e.Converter.Document;o.nodes=n.createScene(r,s);if(s.options.worldTransform.value){for(var u=0;u<o.nodes.length;++u)t.Node.setupWorldTransform(o.nodes[u],s);this.forEachGeometry(o,function(t){e.Converter.Geometry.setupWorldTransform(t,s)});if(s.options.worldTransformBake.value){var a=t.Utils.getWorldTransform(s);this.forEachGeometry(o,function(t){t.getSkeleton()!==null&&e.Converter.Geometry.transformGeometry(t,a,s)})}}return s.options.enableAnimations.value===!0&&(o.animations=n.createAnimations(r,s)),s.options.enableExtractGeometry.value===!0&&(o.geometries=e.Converter.Node.extractGeometries(o.nodes,s)),s.options.singleBufferPerGeometry.value===!0&&this.forEachGeometry(o,function(t){e.Converter.GeometryChunk.mergeChunkData(t.chunks,s)}),s.options.enableResampledAnimations.value===!0&&(o.resampled_animations=n.createResampledAnimations(r,o,s)),e.Converter.Node.forEachNode(o.nodes,function(t){i.forEachGeometry(o,function(t){e.Converter.Geometry.computeBoundingBox(t,s)})}),o},n.createScene=function(t,n){var r=[];if(t.scene===null)return n.log.write("Collada document has no scene",4),r;var i=e.Loader.VisualScene.fromLink(t.scene.instance,n);if(i===null)return n.log.write("Collada document has no scene",4),r;for(var s=0;s<i.children.length;++s){var o=i.children[s];r.push(e.Converter.Node.createNode(o,null,n))}for(var s=0;s<r.length;++s){var u=r[s];e.Converter.Node.createNodeData(u,n)}return r},n.createAnimations=function(t,n){var r=[];for(var i=0;i<t.libAnimations.children.length;++i){var s=t.libAnimations.children[i];r.push(e.Converter.Animation.create(s,n))}if(n.options.singleAnimation.value===!0&&r.length>1){var o=new e.Converter.Animation;o.id="",o.name="animation";for(var i=0;i<r.length;++i){var u=r[i];o.channels=o.channels.concat(u.channels),u.channels=[]}r=[o]}return r},n.createResampledAnimations=function(t,n,r){var i=[];if(n.animations.length===0)return[];if(n.geometries.length>1)return r.log.write("Converted document contains multiple geometries, resampled animations are only generated for single geometries.",4),[];if(n.geometries.length===0)return r.log.write("Converted document does not contain any geometries, no resampled animations generated.",4),[];var s=n.geometries[0],o=+r.options.animationFps.value;for(var u=0;u<n.animations.length;++u){var a=n.animations[u];if(r.options.useAnimationLabels.value===!0){var f=r.options.animationLabels.value,l=e.Converter.AnimationData.createFromLabels(s.getSkeleton(),a,f,o,r);i=i.concat(l)}else{var c=e.Converter.AnimationData.create(s.getSkeleton(),a,null,null,o,r);c!==null&&i.push(c)}}return i},n}();t.ColladaConverter=n})(t=e.Converter||(e.Converter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(){}return t.stringToBuffer=function(e){var t=atob(e),n=new Uint8Array(t.length);for(var r=0,i=t.length;r<i;++r)n[r]=t.charCodeAt(r);return n},t.bufferToString=function(e){var t="";for(var n=0,r=e.length;n<r;++n)t+=String.fromCharCode(e[n]);return btoa(t)},t.bufferToDataURI=function(t,n){var r=e.Exporter.Utils.bufferToString(t);return n||(n="application/octet-stream"),"data:"+n+";base64,"+r},t.bufferToBlobURI=function(e,t){t||(t="application/octet-stream");var n=new Blob([e],{type:t});return URL.createObjectURL(n)},t.jsonToDataURI=function(e,t){var n=JSON.stringify(e);return t||(t="application/json"),"data:"+t+","+n},t.jsonToBlobURI=function(e,t){t||(t="application/json");var n=new Blob([JSON.stringify(e)],{type:t});return URL.createObjectURL(n)},t}();t.Utils=n})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(){this.json=null,this.data=null}return e}();e.Document=t})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(){this.data=null,this.stride=null,this.count=null,this.byte_offset=null,this.bytes_per_element=null}return t.prototype.getDataView=function(){return new Uint8Array(this.data.buffer,0,this.stride*this.count*this.bytes_per_element)},t.prototype.getBytesCount=function(){return this.data.length*this.bytes_per_element},t.toJSON=function(e){if(e===null)return null;var t={type:e.type,byte_offset:e.byte_offset,stride:e.stride,count:e.count};return t},t.create=function(t,n,r){if(t===null)return null;var i=new e.Exporter.DataChunk;i.data=t,i.stride=n,i.count=t.length/n;if(t instanceof Float32Array)i.type="float",i.bytes_per_element=4;else if(t instanceof Float64Array)i.type="double",i.bytes_per_element=8;else if(t instanceof Uint8Array)i.type="uint8",i.bytes_per_element=1;else if(t instanceof Uint16Array)i.type="uint16",i.bytes_per_element=2;else if(t instanceof Uint32Array)i.type="uint32",i.bytes_per_element=4;else if(t instanceof Int8Array)i.type="int8",i.bytes_per_element=1;else if(t instanceof Int16Array)i.type="int16",i.bytes_per_element=2;else{if(!(t instanceof Int32Array))return r.log.write("Unknown data type, data chunk ignored",4),null;i.type="int32",i.bytes_per_element=4}return r.registerChunk(i),i},t}();t.DataChunk=n})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(e){function t(t){e.call(this),this.log=t,this.chunks=[],this.chunk_data=[],this.bytes_written=0}return __extends(t,e),t.prototype.registerChunk=function(e){this.chunks.push(e),e.byte_offset=this.bytes_written,this.bytes_written+=e.getBytesCount()},t.prototype.assembleData=function(){var e=new ArrayBuffer(this.bytes_written),t=new Uint8Array(e);for(var n=0;n<this.chunks.length;++n){var r=this.chunks[n],i=r.getDataView(),s=i.length,o=r.byte_offset;for(var u=0;u<s;++u)t[u+o]=i[u]}return t},t}(e.Context);t.Context=n})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(){}return e.toJSON=function(e,t){return e===null?null:{name:e.name,diffuse:e.diffuse!==null?e.diffuse.url:null,specular:e.specular!==null?e.specular.url:null,normal:e.normal!==null?e.normal.url:null}},e}();e.Material=t})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function e(){}return e.toJSON=function(e){return e===null?null:{min:[e.min[0],e.min[1],e.min[2]],max:[e.max[0],e.max[1],e.max[2]]}},e}();t.BoundingBox=n;var r=function(){function r(){}return r.toJSON=function(r,i,s){var o=e.Exporter.DataChunk.create(r.data.indices,3,s),u=e.Exporter.DataChunk.create(r.data.position,3,s),a=e.Exporter.DataChunk.create(r.data.normal,3,s),f=e.Exporter.DataChunk.create(r.data.texcoord,2,s),l=e.Exporter.DataChunk.create(r.data.boneweight,4,s),c=e.Exporter.DataChunk.create(r.data.boneindex,4,s);return{name:r.name,material:i,vertex_count:r.vertexCount,triangle_count:r.triangleCount,indices:t.DataChunk.toJSON(o),position:t.DataChunk.toJSON(u),normal:t.DataChunk.toJSON(a),texcoord:t.DataChunk.toJSON(f),boneweight:t.DataChunk.toJSON(l),boneindex:t.DataChunk.toJSON(c),bounding_box:n.toJSON(r.boundingBox)}},r}();t.Geometry=r})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function t(){}return t.toJSON=function(t,n){if(t===null)return null;var r=6,i=6,s=3,o=6,u=[];return t.bones.forEach(function(n){var a=n.node.initialLocalMatrix,f=[0,0,0],l=[0,0,0,1],c=[1,1,1];e.MathUtils.decompose(a,f,l,c);var h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];e.MathUtils.copyNumberArray(n.invBindMatrix,h,16),u.push({name:n.name,parent:t.bones.indexOf(n.parent),skinned:n.attachedToSkin,inv_bind_mat:h.map(function(t){return e.MathUtils.round(t,r)}),pos:f.map(function(t){return e.MathUtils.round(t,i)}),rot:l.map(function(t){return e.MathUtils.round(t,o)}),scl:c.map(function(t){return e.MathUtils.round(t,s)})})}),u},t}();t.Skeleton=n})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){}return n.toJSON=function(n,r,i){if(n===null)return null;var s=e.Exporter.DataChunk.create(n.pos,3,i),o=e.Exporter.DataChunk.create(n.rot,4,i),u=e.Exporter.DataChunk.create(n.scl,3,i);return{bone:r,pos:t.DataChunk.toJSON(s),rot:t.DataChunk.toJSON(o),scl:t.DataChunk.toJSON(u)}},n}();t.AnimationTrack=n})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function t(){}return t.toJSON=function(t,n){return t===null?null:{name:t.name,frames:t.keyframes,fps:t.fps,tracks:t.tracks.map(function(t,r){return e.AnimationTrack.toJSON(t,r,n)})}},t}();e.Animation=t})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){this.log=new e.LogConsole}return n.prototype.export=function(n){var r=new e.Exporter.Context(this.log);if(n===null)return r.log.write("No document to convert",4),null;if(n.geometries.length===0)return r.log.write("Document contains no geometry, nothing exported",4),null;n.geometries.length>1&&r.log.write("Document contains multiple geometries, only the first geometry is exported",4);var i=[],s=[],o=n.geometries[0],u=[];for(var a=0;a<o.chunks.length;++a){var f=o.chunks[a],l=i.indexOf(f.material);if(l===-1){var c=t.Material.toJSON(f.material,r);l=s.length,i.push(f.material),s.push(c)}u.push(t.Geometry.toJSON(f,l,r))}var h=new e.Exporter.Document,p={bounding_box:t.BoundingBox.toJSON(o.boundingBox)},d=t.Skeleton.toJSON(o.getSkeleton(),r),v=n.resampled_animations.map(function(e){return t.Animation.toJSON(e,r)});return h.json={info:p,materials:s,chunks:u,bones:d,animations:v},h.data=r.assembleData(),h},n}();t.ColladaExporter=n})(t=e.Exporter||(e.Exporter={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(e){function t(t){e.call(this),this.log=t,this.mat_tol=5,this.pos_tol=5,this.scl_tol=3,this.rot_tol=5,this.uvs_tol=4,this.nrm_tol=5}return __extends(t,e),t}(e.Context);t.Context=n})(t=e.Threejs||(e.Threejs={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(e){var t=function(){function e(){}return e.toJSON=function(e,t){return e===null?null:{DbgColor:0,DbgIndex:1,DbgName:e.name,blending:"NormalBlending",colorAmbient:[1,1,1],colorDiffuse:[1,1,1],colorSpecular:[.5,.5,.5],depthTest:!0,depthWrite:!0,mapDiffuse:e.diffuse!==null?e.diffuse.url.replace(".tga",".png"):null,mapDiffuseWrap:["repeat","repeat"],mapSpecular:e.specular!==null?e.specular.url.replace(".tga",".png"):null,mapSpecularWrap:["repeat","repeat"],mapNormal:e.normal!==null?e.normal.url.replace(".tga",".png"):null,mapNormalWrap:["repeat","repeat"],shading:"Lambert",specularCoef:50,transparency:1,transparent:!1,vertexColors:!1}},e}();e.Material=t})(t=e.Threejs||(e.Threejs={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){function n(e){if(e===null){var t=mat4.create();return mat4.identity(t),t}var i=n(e.parent),s=r(e),t=mat4.create();return mat4.multiply(t,i,s),t}function r(e){if(e===null){var t=mat4.create();return mat4.identity(t),t}var r=mat4.clone(e.invBindMatrix),i=mat4.create();mat4.invert(i,r);var s=n(e.parent),o=mat4.create();mat4.invert(o,s);var t=mat4.create();return mat4.multiply(t,o,i),t}function i(t){var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return e.MathUtils.copyNumberArray(t,n,16),n}var s=function(){function t(){}return t.toJSON=function(t,n,s){if(t===null||n===null)return null;var o=r(n),u=[0,0,0],a=[0,0,0,1],f=[1,1,1];return e.MathUtils.decompose(o,u,a,f),{parent:t.bones.indexOf(n.parent),name:n.name,pos:u.map(function(t){return e.MathUtils.round(t,s.pos_tol)}),rotq:a.map(function(t){return e.MathUtils.round(t,s.rot_tol)}),scl:f.map(function(t){return e.MathUtils.round(t,s.scl_tol)}),inv_bind_mat:i(n.invBindMatrix).map(function(t){return e.MathUtils.round(t,s.mat_tol)})}},t}();t.Bone=s})(t=e.Threejs||(e.Threejs={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){function n(e,t){return+e.toFixed(t)}function r(e,t,r){return[n(e[3*t+0],r),n(e[3*t+1],r),n(e[3*t+2],r)]}function i(e,t,r){return[n(e[4*t+0],r),n(e[4*t+1],r),n(e[4*t+2],r),n(e[4*t+3],r)]}var s=function(){function t(){}return t.toJSON=function(t,s,o,u){if(t===null)return null;var a=Math.floor(t.original_fps+.5),f=a/t.fps;return{name:t.name||"animation",length:t.keyframes,fps:t.fps,hierarchy:t.tracks.map(function(o,u){var a=s[u].node.initialLocalMatrix,l=new Float32Array(3),c=new Float32Array(4),h=new Float32Array(3);e.MathUtils.decompose(a,l,c,h);var p=[];for(var d=0;d<t.keyframes;++d){var v={time:n(d*f,2)};o.pos&&(v.pos=r(o.pos,d,4)),o.rot&&(v.rot=i(o.rot,d,4)),o.scl&&(v.scl=r(o.scl,d,3));if(d==0||d==t.keyframes-1)o.pos||(v.pos=r(l,0,4)),o.rot||(v.rot=i(c,0,4)),o.scl||(v.scl=r(h,0,3));(v.pos||v.rot||v.scl)&&p.push(v)}return{parent:u-1,keys:p}})}},t}();t.Animation=s})(t=e.Threejs||(e.Threejs={}))})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t;(function(t){var n=function(){function n(){this.log=new e.LogConsole}return n.prototype.export=function(n){var r=new e.Threejs.Context(this.log);if(n===null)return r.log.write("No document to convert",4),null;if(n.geometries.length===0)return r.log.write("Document contains no geometry, nothing exported",4),null;n.geometries.length>1&&r.log.write("Document contains multiple geometries, only the first geometry is exported",4);var i=n.geometries[0],s=[],o=[],u=[],a=[],f=[],l=[],c=[],h=[],p=0;for(var d=0;d<i.chunks.length;++d){var v=i.chunks[d],m=s.indexOf(v.material);if(m===-1){var g=t.Material.toJSON(v.material,r);m=o.length,s.push(v.material),o.push(g)}for(var y=0;y<v.vertexCount;++y){if(v.data.position){var b=3*v.vertexBufferOffset+3*y;u.push(v.data.position[b+0]),u.push(v.data.position[b+1]),u.push(v.data.position[b+2])}if(v.data.normal){var b=3*v.vertexBufferOffset+3*y;a.push(v.data.normal[b+0]),a.push(v.data.normal[b+1]),a.push(v.data.normal[b+2])}if(v.data.texcoord){var b=2*v.vertexBufferOffset+2*y;f.push(v.data.texcoord[b+0]),f.push(v.data.texcoord[b+1])}if(v.data.boneindex){var b=4*v.vertexBufferOffset+4*y;c.push(v.data.boneindex[b+0]),c.push(v.data.boneindex[b+1])}if(v.data.boneweight){var b=4*v.vertexBufferOffset+4*y,w=v.data.boneweight[b+0],E=v.data.boneweight[b+1],S=w+E;S>0&&(w/=S,E/=S),h.push(w),h.push(E)}}for(var y=0;y<v.triangleCount;++y){var b=v.indexBufferOffset+3*y,x=p+v.data.indices[b+0],T=p+v.data.indices[b+1],N=p+v.data.indices[b+2];l.push(42),l.push(x),l.push(T),l.push(N),l.push(m),l.push(x),l.push(T),l.push(N),l.push(x),l.push(T),l.push(N)}p+=v.vertexCount}var C=[],k=[],L=i.getSkeleton();return L!==null&&(C=L.bones.map(function(t){return e.Threejs.Bone.toJSON(L,t,r)}),k=n.resampled_animations.map(function(t){return e.Threejs.Animation.toJSON(t,L.bones,C,r)})),{metadata:{formatVersion:3.1,generatedBy:"Collada Converter"},scale:1,materials:o,vertices:u.map(function(t){return e.MathUtils.round(t,r.pos_tol)}),morphTargets:[],normals:a.map(function(t){return e.MathUtils.round(t,r.nrm_tol)}),colors:[],uvs:[f.map(function(t){return e.MathUtils.round(t,r.uvs_tol)})],faces:l,skinIndices:c,skinWeights:h.map(function(t){return e.MathUtils.round(t,r.uvs_tol)}),bones:C,animation:k[0]}},n}();t.ThreejsExporter=n})(t=e.Threejs||(e.Threejs={}))})(COLLADA||(COLLADA={}));